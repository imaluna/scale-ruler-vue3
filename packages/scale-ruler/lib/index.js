"use strict";const t=require("vue"),L=t.defineComponent({__name:"CanvasPanel",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},canvasInfo:{type:Object,required:!0}},setup(a){const r=a,e=t.computed(()=>{var l,n;return{position:"absolute",left:0,top:0,width:((l=r.opt)==null?void 0:l.canvasWidth)+"px",height:((n=r.opt)==null?void 0:n.canvasHeight)+"px",transition:"transform 300ms",transformOrigin:"0 0",transform:`translate(${r.canvasInfo.translateX}px, ${r.canvasInfo.translateY}px) scale(${r.canvasInfo.scale})`,...r.opt.canvasStyle}});return(l,n)=>(t.openBlock(),t.createElementBlock("div",{ref:"canvasPanel",style:t.normalizeStyle(e.value)},null,4))}}),E=t.defineComponent({__name:"ScrollBar",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},scrollBarInfo:{type:Object,required:!0},scrollBarOpacity:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},setup(a){const r=a,{scrollBarOpacity:e,transformInfo:l}=t.toRefs(r),n=t.computed(()=>{const{opt:d,scrollBarInfo:u,isY:p}=r,{scrollBarConfig:g}=d,b={position:"absolute",borderRadius:"4px",backgroundColor:g.bgColor,opacity:r.scrollBarOpacity[p?"yOpacity":"xOpacity"]||0,transition:"opacity 300ms",cursor:"pointer",zIndex:g.zIndex,width:(p?g.barSize:u.width)+"px",height:(p?u.height:g.barSize)+"px"};return p?(b.top=u.top+"px",b.right=0):(b.left=u.left+"px",b.bottom=0),b}),i=t.ref(null),o={};function h(d){if(d.preventDefault(),!e.value.isMouseDown)return;let{translateX:u,translateY:p}=l.value;const g=r.scrollBarInfo,{width:b,height:c}=r.containerInfo;if(r.isY){const m=d.pageY-o.startY;let x=o.top+m;x=Math.min(Math.max(0,x),c-g.height);const B=x*g.totalHeight/c;p=r.opt.containerYPadding-B,l.value.translateY=p}else{const m=d.pageX-o.startX;let x=o.left+m;x=Math.min(Math.max(0,x),c-g.height);const B=x*g.totalWidth/c;u=r.opt.containerXPadding-B,l.value.translateX=u}}return t.onMounted(()=>{if(i.value){const d=i.value,u=r.isY?"yOpacity":"xOpacity";d.addEventListener("mouseenter",()=>{e.value[u]=r.opt.scrollBarConfig.opacity,e.value[r.isY?"xOpacity":"yOpacity"]=0,e.value.isMouseEnter=!0}),d.addEventListener("mouseleave",()=>{e.value.isMouseEnter=!1,e.value[u]=0}),d.addEventListener("mousedown",p=>{e.value.isMouseDown=!0,o.startX=p.pageX,o.startY=p.pageY,o.left=r.scrollBarInfo.left,o.top=r.scrollBarInfo.top,document.addEventListener("mousemove",h)}),document.addEventListener("mouseup",()=>{e.value.isMouseDown=!1,document.removeEventListener("mousemove",h)})}}),(d,u)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"scrollBarRef",ref:i,style:t.normalizeStyle(n.value)},null,4))}}),H=a=>a<=.25?40:a<=.5?20:a<=1?10:a<=2?5:a<=4?2:1,A=(a,r,e,l)=>{t.nextTick(()=>{const n=l.value;if(n){const i=n.offsetWidth,o=n.offsetHeight,{rulerConfig:h}=a,{bgColor:d,fontFamily:u,fontSize:p,lineColor:g,fontColor:b}=h;if(i>0&&o>0){const c=n.getContext("2d");c.clearRect(0,0,i,o),d&&(c.save(),c.fillStyle=d,c.fillRect(0,0,i,o),c.restore());const m=e?h.yRulerWidth:h.xRulerHeight,{translateX:x,translateY:B,scale:s}=r,f=e?B:x,y=H(s),S=y*s,v=window.devicePixelRatio,Y=-f,I=Math.floor(Y/S),X=Math.floor(((e?o:i)-f)/S);c.save(),c.fillStyle=g,c.font=`${p*v}px ${u}`,c.translate(.5,.5),c.scale(1/v,1/v),e?c.fillRect((m-1)*v,0,1,o*v):c.fillRect(0,(m-1)*v,i*v,1);for(let M=I;M<=X;M++){c.fillStyle=g;const w=(f+M*S)*v;let C=m/4;M%10===0?C=m*4/5:M%5===0&&(C=m/3),e?c.fillRect((m-C)*v,w,C*v,1):(c.fillRect(w,(m-C)*v,1,C*v),M%10===0&&(c.fillStyle=b,c.fillText(String(M*y),w+2*v,(m+8-C)*v)))}if(c.restore(),e){c.font=`${p}px ${u}`;let M=I;for(;M<=X;)if(M%10)M++;else{c.save();const w=f+M*S+m/2;c.translate(w+m/5,w-m*6/5),c.rotate(Math.PI/2),c.fillText(String(M*y),m*4/5,w),M+=10,c.restore()}}}}})},k=["width","height"],R=t.defineComponent({__name:"Ruler",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},canvasInfo:{type:Object,required:!0},isY:{type:Boolean,default:!1}},setup(a){const r=a,e=t.computed(()=>{const{isY:i,containerInfo:o,opt:h}=r;return{width:i?h.rulerConfig.yRulerWidth:o.width,height:i?o.height:h.rulerConfig.xRulerHeight}}),l=t.computed(()=>({position:"absolute",left:0,top:0,zIndex:r.opt.rulerConfig.zIndex+(r.isY?0:1)})),n=t.ref();return t.watch([()=>r.containerInfo,()=>r.canvasInfo],()=>{A(r.opt,r.canvasInfo,r.isY,n)},{deep:!0}),(i,o)=>(t.openBlock(),t.createElementBlock("canvas",{ref_key:"rulerRef",ref:n,style:t.normalizeStyle(l.value),width:e.value.width,height:e.value.height},null,12,k))}});function q(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var j,W;function D(){if(W)return j;W=1;var a=function(f){return r(f)&&!e(f)};function r(s){return!!s&&typeof s=="object"}function e(s){var f=Object.prototype.toString.call(s);return f==="[object RegExp]"||f==="[object Date]"||i(s)}var l=typeof Symbol=="function"&&Symbol.for,n=l?Symbol.for("react.element"):60103;function i(s){return s.$$typeof===n}function o(s){return Array.isArray(s)?[]:{}}function h(s,f){return f.clone!==!1&&f.isMergeableObject(s)?x(o(s),s,f):s}function d(s,f,y){return s.concat(f).map(function(S){return h(S,y)})}function u(s,f){if(!f.customMerge)return x;var y=f.customMerge(s);return typeof y=="function"?y:x}function p(s){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(s).filter(function(f){return Object.propertyIsEnumerable.call(s,f)}):[]}function g(s){return Object.keys(s).concat(p(s))}function b(s,f){try{return f in s}catch{return!1}}function c(s,f){return b(s,f)&&!(Object.hasOwnProperty.call(s,f)&&Object.propertyIsEnumerable.call(s,f))}function m(s,f,y){var S={};return y.isMergeableObject(s)&&g(s).forEach(function(v){S[v]=h(s[v],y)}),g(f).forEach(function(v){c(s,v)||(b(s,v)&&y.isMergeableObject(f[v])?S[v]=u(v,y)(s[v],f[v],y):S[v]=h(f[v],y))}),S}function x(s,f,y){y=y||{},y.arrayMerge=y.arrayMerge||d,y.isMergeableObject=y.isMergeableObject||a,y.cloneUnlessOtherwiseSpecified=h;var S=Array.isArray(f),v=Array.isArray(s),Y=S===v;return Y?S?y.arrayMerge(s,f,y):m(s,f,y):h(f,y)}x.all=function(f,y){if(!Array.isArray(f))throw new Error("first argument should be an array");return f.reduce(function(S,v){return x(S,v,y)},{})};var B=x;return j=B,j}var $=D();const P=q($),_={scale:1,canScale:!0,maxScale:10,minScale:.1,autoCenter:!0,autoScale:!0,containerAutoSize:!1,containerWidth:1e3,containerHeight:500,containerXPadding:80,containerYPadding:80,canvasWidth:1920,canvasHeight:2e3,proxyScaleKey:!0,useScrollBar:!0,useRuler:!0,usePositionLine:!0,positionLineConfig:{lineColor:"#24aa61",padding:3,adsorptionXList:[],adsorptionYList:[],adsorptionGap:4,zIndex:300},canvasStyle:{},scrollBarConfig:{bgColor:"#000000",opacity:.4,zIndex:500,barSize:8},rulerConfig:{yRulerWidth:30,xRulerHeight:30,bgColor:"#efefef",fontColor:"#000000",fontSize:12,fontFamily:"Arial",lineColor:"#000000",zIndex:400},onScale:()=>{},onMove:()=>{}},F=function(){const a={};for(const r in _){const e=_[r];typeof e=="object"&&e!==null?a[r]=()=>e:a[r]=e}return a}(),O=t.reactive({width:0,height:0,originWidth:0,originHeight:0});function K(a){new ResizeObserver(e=>{for(const l of e)if(l.target===a){const n=a.offsetWidth,i=a.offsetHeight;n!==O.originWidth||O.originHeight}}).observe(a)}const N=(a,r)=>{t.onMounted(()=>{const n=a.value,i=r.value;if(i){n.containerAutoSize?(O.width=i.offsetWidth,O.height=i.offsetHeight,O.originWidth=O.width,O.originHeight=O.height,K(i)):(O.width=n.containerWidth,O.height=n.containerHeight);const o=getComputedStyle(i);o.boxSizing==="border-box"&&(O.width-=parseFloat(o.borderLeftWidth)+parseFloat(o.borderRightWidth),O.height-=parseFloat(o.borderTopWidth)+parseFloat(o.borderBottomWidth)),o.position==="static"&&(O.position="relative")}});const e=t.computed(()=>({width:O.width,height:O.height})),l=t.computed(()=>{const n=a.value,i={overflow:"hidden"};return n.containerAutoSize||(i.width=O.width+"px",i.height=O.height+"px"),O.position&&(i.position=O.position),i});return{containerInfo:e,containerStyle:l}},V=(a,r)=>{const e=t.reactive({});return t.watch(()=>r.value,()=>{const l=a.value;let n=0,i=0,{scale:o}=l;const{autoCenter:h,autoScale:d}=l,{width:u,height:p}=r.value;if(d){const c=(u-2*l.containerXPadding)/l.canvasWidth,m=(p-2*l.containerYPadding)/l.canvasHeight;o=Math.min(c,m)}e.scale=o;let g=0,b=0;n=l.canvasWidth*o,i=l.canvasHeight*o,h&&(g=Math.floor((u-n)/2),b=Math.floor((p-i)/2),e.translateX=g,e.translateY=b)},{deep:!0}),{transformInfo:e}},U=(a,r,e)=>({scrollBarInfo:t.computed(()=>{console.log(e,"--transformInfo-33");const n=a.value,{width:i,height:o}=r.value,{translateX:h,translateY:d,scale:u}=e,p=n.canvasWidth*u+2*n.containerXPadding,g=n.canvasHeight*u+2*n.containerYPadding,b=i<p,c=o<g,m=b||c,x=i*((n.containerXPadding-h)/p),B=o*((n.containerYPadding-d)/p),s=i/p*i,f=o/g*o;return{totalHeight:g,totalWidth:p,left:x,top:B,width:s,height:f,isYLarge:c,isXLarge:b,isLarge:m}})});function T(a,r,e){const l=a.value,{containerXPadding:n,containerYPadding:i,canvasWidth:o,canvasHeight:h}=l,d=o*e,u=h*e,{width:p,height:g}=r.value,b=Math.max((p-d)/2,n),c=Math.max((g-u)/2,i),m=d+2*n>p?p-(d+n):b,x=u+2*i>g?g-(u+i):c;return{maxTranslateX:b,maxTranslateY:c,minTranslateX:m,minTranslateY:x}}const G=(a,r,e)=>({boundaryInfo:t.computed(()=>T(a,r,e.scale))}),z=(a,r,e,l)=>{const n=a.value;let{translateX:i,translateY:o,scale:h}=e;l=Math.min(Math.max(l,n.minScale),n.maxScale);const d=l-h,u=T(a,r,l);i-=d*n.canvasWidth/2,o-=d*n.canvasHeight/2,i=Math.max(Math.min(i,u.maxTranslateX),u.minTranslateX),o=Math.max(Math.min(o,u.maxTranslateY),u.minTranslateY),e.scale=l,e.translateX=i,e.translateY=o},J=(a,r,e)=>{a.value.proxyScaleKey&&document.addEventListener("keydown",l=>{if(a.value.canScale){const n=l.keyCode;if((l.metaKey||l.ctrlKey)&&(n===187||n===189)){l.preventDefault();const i=e.scale+(n===187?.05:-.05);z(a,r,e,i)}}})},Q=(a,r,e,l,n,i)=>{let o=null;const h=t.reactive({xOpacity:0,yOpacity:0,isMouseDown:!1,isMouseEnter:!1});return t.onMounted(()=>{n.value&&n.value.addEventListener("wheel",d=>{if(d.metaKey||d.ctrlKey){d.preventDefault();const u=-1*d.deltaY/100,p=e.scale+u;z(a,r,e,p)}else{if(console.log(h,"--scrollBarOpacity-1-"),!i.value.isLarge||h.isMouseDown)return;d.preventDefault();let{translateX:u,translateY:p}=e;o&&clearTimeout(o);const g=-d.deltaX,b=-d.deltaY;let c="";const{opacity:m=.4}=a.value.scrollBarConfig,{isXLarge:x,isYLarge:B}=i.value,{maxTranslateX:s,minTranslateX:f,maxTranslateY:y,minTranslateY:S}=l.value;x&&Math.abs(g)>Math.abs(b)&&(u+=g,u=Math.max(Math.min(u,s),f),h.xOpacity=m,h.yOpacity=0,e.translateX=u,c="x"),B&&Math.abs(b)>Math.abs(g)&&(c="y",p+=b,p=Math.max(Math.min(p,y),S),h.yOpacity=m,h.xOpacity=0,e.translateY=p),c&&(o=setTimeout(()=>{h.isMouseEnter||(h[c==="y"?"yOpacity":"xOpacity"]=0)},1e3))}})}),{scrollBarOpacity:h}},Z=t.defineComponent({__name:"ScaleRuler",props:t.mergeDefaults({scale:{},minScale:{},maxScale:{},canScale:{type:Boolean},autoCenter:{type:Boolean},autoScale:{type:Boolean},containerAutoSize:{type:Boolean},containerWidth:{},containerHeight:{},containerXPadding:{},containerYPadding:{},canvasWidth:{},canvasHeight:{},proxyScaleKey:{type:Boolean},useScrollBar:{type:Boolean},useRuler:{type:Boolean},usePositionLine:{type:Boolean},positionLineConfig:{},canvasStyle:{},scrollBarConfig:{},rulerConfig:{},onScale:{type:Function},onMove:{type:Function}},F),setup(a){const r=a,e=t.ref(P(_,r)),l=t.ref(null),{containerInfo:n,containerStyle:i}=N(e,l),{transformInfo:o}=V(e,n),{boundaryInfo:h}=G(e,n,o),d=t.computed(()=>Object.assign({},o,h.value)),{scrollBarInfo:u}=U(e,n,o),p=t.reactive({}),g=t.watch(()=>d.value,c=>{if(c.scale){const m={scale:c.scale,translateX:c.translateX,translateY:c.translateY};p.scale||Object.assign(p,m),g()}});t.watch(()=>r,()=>{e.value=P(e.value,r)},{deep:!0}),J(e,n,o);const{scrollBarOpacity:b}=Q(e,n,o,h,l,u);return console.log(b,"--scrollBarOpacity-"),(c,m)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"container",ref:l,style:t.normalizeStyle(t.unref(i))},[e.value.useRuler?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.createVNode(R,{opt:e.value,"container-info":t.unref(n),"canvas-info":d.value},null,8,["opt","container-info","canvas-info"]),t.createVNode(R,{"is-y":"",opt:e.value,"container-info":t.unref(n),"canvas-info":d.value},null,8,["opt","container-info","canvas-info"])],64)):t.createCommentVNode("",!0),t.createVNode(L,{"container-info":t.unref(n),opt:e.value,"canvas-info":d.value,"transform-info":t.unref(o)},{default:t.withCtx(()=>[t.renderSlot(c.$slots,"default")]),_:3},8,["container-info","opt","canvas-info","transform-info"]),t.unref(u).isXLarge?(t.openBlock(),t.createBlock(E,{key:1,opt:e.value,"container-info":t.unref(n),"scroll-bar-info":t.unref(u),"scroll-bar-opacity":t.unref(b),"transform-info":t.unref(o)},null,8,["opt","container-info","scroll-bar-info","scroll-bar-opacity","transform-info"])):t.createCommentVNode("",!0),t.unref(u).isYLarge?(t.openBlock(),t.createBlock(E,{key:2,opt:e.value,"container-info":t.unref(n),"scroll-bar-info":t.unref(u),"scroll-bar-opacity":t.unref(b),"transform-info":t.unref(o),"is-y":""},null,8,["opt","container-info","scroll-bar-info","scroll-bar-opacity","transform-info"])):t.createCommentVNode("",!0)],4))}});module.exports=Z;
