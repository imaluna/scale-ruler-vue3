"use strict";const e=require("vue"),H=e.defineComponent({__name:"CanvasPanel",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},canvasInfo:{type:Object,required:!0}},setup(o){const i=o,t=e.computed(()=>{var p,n;return{position:"absolute",left:0,top:0,width:((p=i.opt)==null?void 0:p.canvasWidth)+"px",height:((n=i.opt)==null?void 0:n.canvasHeight)+"px",transition:"transform 300ms",transformOrigin:"0 0",transform:`translate(${i.canvasInfo.translateX}px, ${i.canvasInfo.translateY}px) scale(${i.canvasInfo.scale})`,...i.opt.canvasStyle}});return(p,n)=>(e.openBlock(),e.createElementBlock("div",{ref:"canvasPanel",style:e.normalizeStyle(t.value)},null,4))}}),P=e.defineComponent({__name:"ScrollBar",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},scrollBarInfo:{type:Object,required:!0}},setup(o){const i=o,t=e.computed(()=>{const{opt:p,scrollBarInfo:n,isY:c}=i,{scrollBarConfig:l}=p,s={position:"absolute",borderRadius:"4px",backgroundColor:l.bgColor,opacity:.4,transition:"opacity 300ms",cursor:"pointer",zIndex:l.zIndex,width:(c?l.barSize:n.width)+"px",height:(c?n.height:l.barSize)+"px"};return c?(s.top=n.top+"px",s.right=0):(s.left=n.left+"px",s.bottom=0),s});return(p,n)=>(e.openBlock(),e.createElementBlock("div",{ref:"scrollBar",style:e.normalizeStyle(t.value)},null,4))}}),Y=o=>o<=.25?40:o<=.5?20:o<=1?10:o<=2?5:o<=4?2:1,X=(o,i,t,p)=>{e.nextTick(()=>{const n=p.value;if(n){const c=n.offsetWidth,l=n.offsetHeight,{rulerConfig:s}=o,{bgColor:m,fontFamily:v,fontSize:b,lineColor:S,fontColor:C}=s;if(c>0&&l>0){const u=n.getContext("2d");u.clearRect(0,0,c,l),m&&(u.save(),u.fillStyle=m,u.fillRect(0,0,c,l),u.restore());const g=t?s.yRulerWidth:s.xRulerHeight,{translateX:O,translateY:_,scale:r}=i,a=t?_:O,d=Y(r),y=d*r,f=window.devicePixelRatio,j=-a,R=Math.floor(j/y),z=Math.floor(((t?l:c)-a)/y);u.save(),u.fillStyle=S,u.font=`${b*f}px ${v}`,u.translate(.5,.5),u.scale(1/f,1/f),t?u.fillRect((g-1)*f,0,1,l*f):u.fillRect(0,(g-1)*f,c*f,1);for(let x=R;x<=z;x++){u.fillStyle=S;const w=(a+x*y)*f;let B=g/4;x%10===0?B=g*4/5:x%5===0&&(B=g/3),t?u.fillRect((g-B)*f,w,B*f,1):(u.fillRect(w,(g-B)*f,1,B*f),x%10===0&&(u.fillStyle=C,u.fillText(String(x*d),w+2*f,(g+8-B)*f)))}if(u.restore(),t){u.font=`${b}px ${v}`;let x=R;for(;x<=z;)if(x%10)x++;else{u.save();const w=a+x*y+g/2;u.translate(w+g/5,w-g*6/5),u.rotate(Math.PI/2),u.fillText(String(x*d),g*4/5,w),x+=10,u.restore()}}}}})},T=["width","height"],W=e.defineComponent({__name:"Ruler",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},canvasInfo:{type:Object,required:!0},isY:{type:Boolean,default:!1}},setup(o){const i=o,t=e.computed(()=>{const{isY:c,containerInfo:l,opt:s}=i;return{width:c?s.rulerConfig.yRulerWidth:l.width,height:c?l.height:s.rulerConfig.xRulerHeight}}),p=e.computed(()=>({position:"absolute",left:0,top:0,zIndex:i.opt.rulerConfig.zIndex+(i.isY?0:1)})),n=e.ref();return e.watch([()=>i.containerInfo,()=>i.canvasInfo],()=>{X(i.opt,i.canvasInfo,i.isY,n)},{deep:!0}),(c,l)=>(e.openBlock(),e.createElementBlock("canvas",{ref_key:"rulerRef",ref:n,style:e.normalizeStyle(p.value),width:t.value.width,height:t.value.height},null,12,T))}});function L(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var I,E;function $(){if(E)return I;E=1;var o=function(a){return i(a)&&!t(a)};function i(r){return!!r&&typeof r=="object"}function t(r){var a=Object.prototype.toString.call(r);return a==="[object RegExp]"||a==="[object Date]"||c(r)}var p=typeof Symbol=="function"&&Symbol.for,n=p?Symbol.for("react.element"):60103;function c(r){return r.$$typeof===n}function l(r){return Array.isArray(r)?[]:{}}function s(r,a){return a.clone!==!1&&a.isMergeableObject(r)?O(l(r),r,a):r}function m(r,a,d){return r.concat(a).map(function(y){return s(y,d)})}function v(r,a){if(!a.customMerge)return O;var d=a.customMerge(r);return typeof d=="function"?d:O}function b(r){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r).filter(function(a){return Object.propertyIsEnumerable.call(r,a)}):[]}function S(r){return Object.keys(r).concat(b(r))}function C(r,a){try{return a in r}catch{return!1}}function u(r,a){return C(r,a)&&!(Object.hasOwnProperty.call(r,a)&&Object.propertyIsEnumerable.call(r,a))}function g(r,a,d){var y={};return d.isMergeableObject(r)&&S(r).forEach(function(f){y[f]=s(r[f],d)}),S(a).forEach(function(f){u(r,f)||(C(r,f)&&d.isMergeableObject(a[f])?y[f]=v(f,d)(r[f],a[f],d):y[f]=s(a[f],d))}),y}function O(r,a,d){d=d||{},d.arrayMerge=d.arrayMerge||m,d.isMergeableObject=d.isMergeableObject||o,d.cloneUnlessOtherwiseSpecified=s;var y=Array.isArray(a),f=Array.isArray(r),j=y===f;return j?y?d.arrayMerge(r,a,d):g(r,a,d):s(a,d)}O.all=function(a,d){if(!Array.isArray(a))throw new Error("first argument should be an array");return a.reduce(function(y,f){return O(y,f,d)},{})};var _=O;return I=_,I}var q=$();const A=L(q),M={scale:1,canScale:!0,maxScale:10,minScale:.1,autoCenter:!0,autoScale:!0,containerAutoSize:!1,containerWidth:1e3,containerHeight:500,containerXPadding:80,containerYPadding:80,canvasWidth:1920,canvasHeight:2e3,proxyScaleKey:!0,useScrollBar:!0,useRuler:!0,usePositionLine:!0,positionLineConfig:{lineColor:"#24aa61",padding:3,adsorptionXList:[],adsorptionYList:[],adsorptionGap:4,zIndex:300},canvasStyle:{},scrollBarConfig:{bgColor:"#000000",opacity:.4,zIndex:500,barSize:8},rulerConfig:{yRulerWidth:30,xRulerHeight:30,bgColor:"#efefef",fontColor:"#000000",fontSize:12,fontFamily:"Arial",lineColor:"#000000",zIndex:500},onScale:()=>{},onMove:()=>{}},k=function(){const o={};for(const i in M){const t=M[i];typeof t=="object"&&t!==null?o[i]=()=>t:o[i]=t}return o}(),h=e.reactive({width:0,height:0,originWidth:0,originHeight:0});function F(o){new ResizeObserver(t=>{for(const p of t)if(p.target===o){const n=o.offsetWidth,c=o.offsetHeight;n!==h.originWidth||h.originHeight}}).observe(o)}const N=(o,i)=>{e.onMounted(()=>{const n=o.value,c=i.value;if(c){n.containerAutoSize?(h.width=c.offsetWidth,h.height=c.offsetHeight,h.originWidth=h.width,h.originHeight=h.height,F(c)):(h.width=n.containerWidth,h.height=n.containerHeight);const l=getComputedStyle(c);l.boxSizing==="border-box"&&(h.width-=parseFloat(l.borderLeftWidth)+parseFloat(l.borderRightWidth),h.height-=parseFloat(l.borderTopWidth)+parseFloat(l.borderBottomWidth)),l.position==="static"&&(h.position="relative")}});const t=e.computed(()=>({width:h.width,height:h.height})),p=e.computed(()=>{const n=o.value,c={overflow:"hidden"};return n.containerAutoSize||(c.width=h.width+"px",c.height=h.height+"px"),h.position&&(c.position=h.position),c});return{containerInfo:t,containerStyle:p}};function V(o,i,t,p){const n=t.value,{containerXPadding:c,containerYPadding:l}=n,{width:s,height:m}=p.value,v=Math.max((s-o)/2,c),b=Math.max((m-i)/2,l),S=o+2*c>s?s-(o+c):v,C=i+2*l>m?m-(i+l):b;return{maxTranslateX:v,maxTranslateY:b,minTranslateX:S,minTranslateY:C}}const U=(o,i)=>e.computed(()=>{const t=o.value,p={};let{scale:n}=t;const{autoCenter:c,autoScale:l}=t,{width:s,height:m}=i.value;if(l){const g=(s-2*t.containerXPadding)/t.canvasWidth,O=(m-2*t.containerYPadding)/t.canvasHeight;n=Math.min(g,O)}p.scale=n;let v=0,b=0;const S=t.canvasWidth*n,C=t.canvasHeight*n;c&&(v=Math.floor((s-S)/2),b=Math.floor((m-C)/2),p.translateX=v,p.translateY=b);const u=V(S,C,o,i);return Object.assign(p,u),p}),D=(o,i,t)=>e.computed(()=>{const n=o.value,{width:c,height:l}=i.value,{translateX:s,translateY:m,scale:v}=t.value,b=n.canvasWidth*v+2*n.containerXPadding,S=n.canvasHeight*v+2*n.containerYPadding,C=c<b,u=l<S,g=C||u,O=n.containerXPadding-s,_=n.containerYPadding-m,r=c/b*c,a=l/S*l;return{totalHeight:S,totalWidth:b,left:O,top:_,width:r,height:a,isYLarge:u,isXLarge:C,isLarge:g}}),K=e.defineComponent({__name:"ScaleRuler",props:e.mergeDefaults({scale:{},minScale:{},maxScale:{},canScale:{type:Boolean},autoCenter:{type:Boolean},autoScale:{type:Boolean},containerAutoSize:{type:Boolean},containerWidth:{},containerHeight:{},containerXPadding:{},containerYPadding:{},canvasWidth:{},canvasHeight:{},proxyScaleKey:{type:Boolean},useScrollBar:{type:Boolean},useRuler:{type:Boolean},usePositionLine:{type:Boolean},positionLineConfig:{},canvasStyle:{},scrollBarConfig:{},rulerConfig:{},onScale:{type:Function},onMove:{type:Function}},k),setup(o){const i=o,t=e.ref(A(M,i)),p=e.ref(null),{containerInfo:n,containerStyle:c}=N(t,p),l=U(t,n),s=D(t,n,l);return e.watch(()=>i,()=>{t.value=A(t.value,i)},{deep:!0}),(m,v)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:p,style:e.normalizeStyle(e.unref(c))},[t.value.useRuler?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(W,{opt:t.value,"container-info":e.unref(n),"canvas-info":e.unref(l)},null,8,["opt","container-info","canvas-info"]),e.createVNode(W,{"is-y":"",opt:t.value,"container-info":e.unref(n),"canvas-info":e.unref(l)},null,8,["opt","container-info","canvas-info"])],64)):e.createCommentVNode("",!0),e.createVNode(H,{"container-info":e.unref(n),opt:t.value,"canvas-info":e.unref(l)},{default:e.withCtx(()=>[e.renderSlot(m.$slots,"default")]),_:3},8,["container-info","opt","canvas-info"]),e.unref(s).isXLarge?(e.openBlock(),e.createBlock(P,{key:1,opt:t.value,"container-info":e.unref(n),"scroll-bar-info":e.unref(s)},null,8,["opt","container-info","scroll-bar-info"])):e.createCommentVNode("",!0),e.unref(s).isYLarge?(e.openBlock(),e.createBlock(P,{key:2,opt:t.value,"container-info":e.unref(n),"scroll-bar-info":e.unref(s),"is-y":""},null,8,["opt","container-info","scroll-bar-info"])):e.createCommentVNode("",!0)],4))}});module.exports=K;
