(function(e,j){typeof exports=="object"&&typeof module<"u"?module.exports=j(require("vue")):typeof define=="function"&&define.amd?define(["vue"],j):(e=typeof globalThis<"u"?globalThis:e||self,e.ScaleRuler=j(e.Vue))})(this,function(e){"use strict";const j=e.defineComponent({__name:"CanvasPanel",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},canvasInfo:{type:Object,required:!0}},setup(o){const a=o,t=e.computed(()=>{var p,n;return{position:"absolute",left:0,top:0,width:((p=a.opt)==null?void 0:p.canvasWidth)+"px",height:((n=a.opt)==null?void 0:n.canvasHeight)+"px",transition:"transform 300ms",transformOrigin:"0 0",transform:`translate(${a.canvasInfo.translateX}px, ${a.canvasInfo.translateY}px) scale(${a.canvasInfo.scale})`,...a.opt.canvasStyle}});return(p,n)=>(e.openBlock(),e.createElementBlock("div",{ref:"canvasPanel",style:e.normalizeStyle(t.value)},null,4))}}),P=e.defineComponent({__name:"ScrollBar",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},scrollBarInfo:{type:Object,required:!0}},setup(o){const a=o,t=e.computed(()=>{const{opt:p,scrollBarInfo:n,isY:c}=a,{scrollBarConfig:l}=p,s={position:"absolute",borderRadius:"4px",backgroundColor:l.bgColor,opacity:.4,transition:"opacity 300ms",cursor:"pointer",zIndex:l.zIndex,width:(c?l.barSize:n.width)+"px",height:(c?n.height:l.barSize)+"px"};return c?(s.top=n.top+"px",s.right=0):(s.left=n.left+"px",s.bottom=0),s});return(p,n)=>(e.openBlock(),e.createElementBlock("div",{ref:"scrollBar",style:e.normalizeStyle(t.value)},null,4))}}),Y=o=>o<=.25?40:o<=.5?20:o<=1?10:o<=2?5:o<=4?2:1,T=(o,a,t,p)=>{e.nextTick(()=>{const n=p.value;if(n){const c=n.offsetWidth,l=n.offsetHeight,{rulerConfig:s}=o,{bgColor:m,fontFamily:b,fontSize:S,lineColor:x,fontColor:O}=s;if(c>0&&l>0){const f=n.getContext("2d");f.clearRect(0,0,c,l),m&&(f.save(),f.fillStyle=m,f.fillRect(0,0,c,l),f.restore());const g=t?s.yRulerWidth:s.xRulerHeight,{translateX:_,translateY:I,scale:r}=a,i=t?I:_,d=Y(r),y=d*r,u=window.devicePixelRatio,z=-i,A=Math.floor(z/y),H=Math.floor(((t?l:c)-i)/y);f.save(),f.fillStyle=x,f.font=`${S*u}px ${b}`,f.translate(.5,.5),f.scale(1/u,1/u),t?f.fillRect((g-1)*u,0,1,l*u):f.fillRect(0,(g-1)*u,c*u,1);for(let C=A;C<=H;C++){f.fillStyle=x;const w=(i+C*y)*u;let B=g/4;C%10===0?B=g*4/5:C%5===0&&(B=g/3),t?f.fillRect((g-B)*u,w,B*u,1):(f.fillRect(w,(g-B)*u,1,B*u),C%10===0&&(f.fillStyle=O,f.fillText(String(C*d),w+2*u,(g+8-B)*u)))}if(f.restore(),t){f.font=`${S}px ${b}`;let C=A;for(;C<=H;)if(C%10)C++;else{f.save();const w=i+C*y+g/2;f.translate(w+g/5,w-g*6/5),f.rotate(Math.PI/2),f.fillText(String(C*d),g*4/5,w),C+=10,f.restore()}}}}})},X=["width","height"],W=e.defineComponent({__name:"Ruler",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},canvasInfo:{type:Object,required:!0},isY:{type:Boolean,default:!1}},setup(o){const a=o,t=e.computed(()=>{const{isY:c,containerInfo:l,opt:s}=a;return{width:c?s.rulerConfig.yRulerWidth:l.width,height:c?l.height:s.rulerConfig.xRulerHeight}}),p=e.computed(()=>({position:"absolute",left:0,top:0,zIndex:a.opt.rulerConfig.zIndex+(a.isY?0:1)})),n=e.ref();return e.watch([()=>a.containerInfo,()=>a.canvasInfo],()=>{T(a.opt,a.canvasInfo,a.isY,n)},{deep:!0}),(c,l)=>(e.openBlock(),e.createElementBlock("canvas",{ref_key:"rulerRef",ref:n,style:e.normalizeStyle(p.value),width:t.value.width,height:t.value.height},null,12,X))}});function L(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var R,v;function $(){if(v)return R;v=1;var o=function(i){return a(i)&&!t(i)};function a(r){return!!r&&typeof r=="object"}function t(r){var i=Object.prototype.toString.call(r);return i==="[object RegExp]"||i==="[object Date]"||c(r)}var p=typeof Symbol=="function"&&Symbol.for,n=p?Symbol.for("react.element"):60103;function c(r){return r.$$typeof===n}function l(r){return Array.isArray(r)?[]:{}}function s(r,i){return i.clone!==!1&&i.isMergeableObject(r)?_(l(r),r,i):r}function m(r,i,d){return r.concat(i).map(function(y){return s(y,d)})}function b(r,i){if(!i.customMerge)return _;var d=i.customMerge(r);return typeof d=="function"?d:_}function S(r){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r).filter(function(i){return Object.propertyIsEnumerable.call(r,i)}):[]}function x(r){return Object.keys(r).concat(S(r))}function O(r,i){try{return i in r}catch{return!1}}function f(r,i){return O(r,i)&&!(Object.hasOwnProperty.call(r,i)&&Object.propertyIsEnumerable.call(r,i))}function g(r,i,d){var y={};return d.isMergeableObject(r)&&x(r).forEach(function(u){y[u]=s(r[u],d)}),x(i).forEach(function(u){f(r,u)||(O(r,u)&&d.isMergeableObject(i[u])?y[u]=b(u,d)(r[u],i[u],d):y[u]=s(i[u],d))}),y}function _(r,i,d){d=d||{},d.arrayMerge=d.arrayMerge||m,d.isMergeableObject=d.isMergeableObject||o,d.cloneUnlessOtherwiseSpecified=s;var y=Array.isArray(i),u=Array.isArray(r),z=y===u;return z?y?d.arrayMerge(r,i,d):g(r,i,d):s(i,d)}_.all=function(i,d){if(!Array.isArray(i))throw new Error("first argument should be an array");return i.reduce(function(y,u){return _(y,u,d)},{})};var I=_;return R=I,R}var q=$();const E=L(q),M={scale:1,canScale:!0,maxScale:10,minScale:.1,autoCenter:!0,autoScale:!0,containerAutoSize:!1,containerWidth:1e3,containerHeight:500,containerXPadding:80,containerYPadding:80,canvasWidth:1920,canvasHeight:2e3,proxyScaleKey:!0,useScrollBar:!0,useRuler:!0,usePositionLine:!0,positionLineConfig:{lineColor:"#24aa61",padding:3,adsorptionXList:[],adsorptionYList:[],adsorptionGap:4,zIndex:300},canvasStyle:{},scrollBarConfig:{bgColor:"#000000",opacity:.4,zIndex:500,barSize:8},rulerConfig:{yRulerWidth:30,xRulerHeight:30,bgColor:"#efefef",fontColor:"#000000",fontSize:12,fontFamily:"Arial",lineColor:"#000000",zIndex:500},onScale:()=>{},onMove:()=>{}},k=function(){const o={};for(const a in M){const t=M[a];typeof t=="object"&&t!==null?o[a]=()=>t:o[a]=t}return o}(),h=e.reactive({width:0,height:0,originWidth:0,originHeight:0});function F(o){new ResizeObserver(t=>{for(const p of t)if(p.target===o){const n=o.offsetWidth,c=o.offsetHeight;n!==h.originWidth||h.originHeight}}).observe(o)}const V=(o,a)=>{e.onMounted(()=>{const n=o.value,c=a.value;if(c){n.containerAutoSize?(h.width=c.offsetWidth,h.height=c.offsetHeight,h.originWidth=h.width,h.originHeight=h.height,F(c)):(h.width=n.containerWidth,h.height=n.containerHeight);const l=getComputedStyle(c);l.boxSizing==="border-box"&&(h.width-=parseFloat(l.borderLeftWidth)+parseFloat(l.borderRightWidth),h.height-=parseFloat(l.borderTopWidth)+parseFloat(l.borderBottomWidth)),l.position==="static"&&(h.position="relative")}});const t=e.computed(()=>({width:h.width,height:h.height})),p=e.computed(()=>{const n=o.value,c={overflow:"hidden"};return n.containerAutoSize||(c.width=h.width+"px",c.height=h.height+"px"),h.position&&(c.position=h.position),c});return{containerInfo:t,containerStyle:p}};function N(o,a,t,p){const n=t.value,{containerXPadding:c,containerYPadding:l}=n,{width:s,height:m}=p.value,b=Math.max((s-o)/2,c),S=Math.max((m-a)/2,l),x=o+2*c>s?s-(o+c):b,O=a+2*l>m?m-(a+l):S;return{maxTranslateX:b,maxTranslateY:S,minTranslateX:x,minTranslateY:O}}const U=(o,a)=>e.computed(()=>{const t=o.value,p={};let{scale:n}=t;const{autoCenter:c,autoScale:l}=t,{width:s,height:m}=a.value;if(l){const g=(s-2*t.containerXPadding)/t.canvasWidth,_=(m-2*t.containerYPadding)/t.canvasHeight;n=Math.min(g,_)}p.scale=n;let b=0,S=0;const x=t.canvasWidth*n,O=t.canvasHeight*n;c&&(b=Math.floor((s-x)/2),S=Math.floor((m-O)/2),p.translateX=b,p.translateY=S);const f=N(x,O,o,a);return Object.assign(p,f),p}),D=(o,a,t)=>e.computed(()=>{const n=o.value,{width:c,height:l}=a.value,{translateX:s,translateY:m,scale:b}=t.value,S=n.canvasWidth*b+2*n.containerXPadding,x=n.canvasHeight*b+2*n.containerYPadding,O=c<S,f=l<x,g=O||f,_=n.containerXPadding-s,I=n.containerYPadding-m,r=c/S*c,i=l/x*l;return{totalHeight:x,totalWidth:S,left:_,top:I,width:r,height:i,isYLarge:f,isXLarge:O,isLarge:g}});return e.defineComponent({__name:"ScaleRuler",props:e.mergeDefaults({scale:{},minScale:{},maxScale:{},canScale:{type:Boolean},autoCenter:{type:Boolean},autoScale:{type:Boolean},containerAutoSize:{type:Boolean},containerWidth:{},containerHeight:{},containerXPadding:{},containerYPadding:{},canvasWidth:{},canvasHeight:{},proxyScaleKey:{type:Boolean},useScrollBar:{type:Boolean},useRuler:{type:Boolean},usePositionLine:{type:Boolean},positionLineConfig:{},canvasStyle:{},scrollBarConfig:{},rulerConfig:{},onScale:{type:Function},onMove:{type:Function}},k),setup(o){const a=o,t=e.ref(E(M,a)),p=e.ref(null),{containerInfo:n,containerStyle:c}=V(t,p),l=U(t,n),s=D(t,n,l);return e.watch(()=>a,()=>{t.value=E(t.value,a)},{deep:!0}),(m,b)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:p,style:e.normalizeStyle(e.unref(c))},[t.value.useRuler?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(W,{opt:t.value,"container-info":e.unref(n),"canvas-info":e.unref(l)},null,8,["opt","container-info","canvas-info"]),e.createVNode(W,{"is-y":"",opt:t.value,"container-info":e.unref(n),"canvas-info":e.unref(l)},null,8,["opt","container-info","canvas-info"])],64)):e.createCommentVNode("",!0),e.createVNode(j,{"container-info":e.unref(n),opt:t.value,"canvas-info":e.unref(l)},{default:e.withCtx(()=>[e.renderSlot(m.$slots,"default")]),_:3},8,["container-info","opt","canvas-info"]),e.unref(s).isXLarge?(e.openBlock(),e.createBlock(P,{key:1,opt:t.value,"container-info":e.unref(n),"scroll-bar-info":e.unref(s)},null,8,["opt","container-info","scroll-bar-info"])):e.createCommentVNode("",!0),e.unref(s).isYLarge?(e.openBlock(),e.createBlock(P,{key:2,opt:t.value,"container-info":e.unref(n),"scroll-bar-info":e.unref(s),"is-y":""},null,8,["opt","container-info","scroll-bar-info"])):e.createCommentVNode("",!0)],4))}})});
