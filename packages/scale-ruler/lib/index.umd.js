(function(e,E){typeof exports=="object"&&typeof module<"u"?module.exports=E(require("vue")):typeof define=="function"&&define.amd?define(["vue"],E):(e=typeof globalThis<"u"?globalThis:e||self,e.ScaleRuler=E(e.Vue))})(this,function(e){"use strict";const E=o=>o<=.25?40:o<=.5?20:o<=1?10:o<=2?5:o<=4?2:1,F=o=>o.getBoundingClientRect(),X=(o,m,n)=>{const{scale:r,translateX:t,translateY:f}=o;return(m-(n?f:t))/r},Y=(o,m,n)=>{const{scale:r,translateX:t,translateY:f}=o,c=m*r;return(n?f:t)+c};function j(o,m,n,r,t,f){const c={coordinate:t,translate:r},p=o.length;if(p>0){let s=0;for(;s<p;){const a=o[s];if(Math.abs(t-a)<=Math.max(n,n/m.scale)){c.coordinate=a,c.translate=Y(m,a,f);break}else if(a>t)break;s++}}return c}function W(o,m){return m}function P(o){return o.sort((m,n)=>m-n)}const K=e.defineComponent({__name:"CanvasPanel",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},setup(o){const m=o,n=e.computed(()=>{var r,t;return{position:"absolute",left:0,top:0,width:((r=m.opt)==null?void 0:r.canvasWidth)+"px",height:((t=m.opt)==null?void 0:t.canvasHeight)+"px",transformOrigin:"0 0",transform:`translate(${m.transformInfo.translateX}px, ${m.transformInfo.translateY}px) scale(${m.transformInfo.scale})`,...m.opt.canvasStyle}});return(r,t)=>(e.openBlock(),e.createElementBlock("div",{ref:"canvasPanel",style:e.normalizeStyle(n.value)},[e.renderSlot(r.$slots,"default")],4))}});function k(o,m,n,r){if(!o)return;function t(f){f.preventDefault(),typeof n=="function"&&n(f)}o.addEventListener("mousedown",f=>{f.button===0&&(f.preventDefault(),typeof m=="function"&&m(f),document.addEventListener("mousemove",t))}),document.addEventListener("mouseup",f=>{document.removeEventListener("mousemove",t),typeof r=="function"&&r(f)})}const H=e.defineComponent({__name:"ScrollBar",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},scrollBarInfo:{type:Object,required:!0},globalInfo:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},emits:["onMove"],setup(o,{emit:m}){const n=o,r=m,{globalInfo:t,transformInfo:f}=e.toRefs(n),c=e.computed(()=>{const{opt:b,scrollBarInfo:i,isY:y}=n,{scrollBarConfig:L}=b,v={position:"absolute",borderRadius:"4px",backgroundColor:L.bgColor,opacity:n.globalInfo[y?"yOpacity":"xOpacity"]||0,transition:"opacity 300ms",cursor:"pointer",zIndex:L.zIndex,width:(y?L.barSize:i.width)+"px",height:(y?i.height:L.barSize)+"px"};return y?(v.top=i.top+"px",v.right=0):(v.left=i.left+"px",v.bottom=0),v}),p=e.ref(null),s={};function a(b){if(b.preventDefault(),!t.value.scrollBarMouseDown)return;let{translateX:i,translateY:y}=f.value;const L=n.scrollBarInfo,{width:v,height:l}=n.containerInfo;if(n.isY){const u=b.pageY-s.startY;let x=s.top+u;x=Math.min(Math.max(0,x),l-L.height);const C=x*L.totalHeight/l;y=n.opt.containerYPadding-C,f.value.translateY=y}else{const u=b.pageX-s.startX;let x=s.left+u;x=Math.min(Math.max(0,x),v-L.width);const C=x*L.totalWidth/v;i=n.opt.containerXPadding-C,f.value.translateX=i}r("onMove",f.value.translateX,f.value.translateY)}function d(b){t.value.scrollBarMouseDown=!0,s.startX=b.pageX,s.startY=b.pageY,s.left=n.scrollBarInfo.left,s.top=n.scrollBarInfo.top}function h(){t.value.scrollBarMouseDown&&(t.value.scrollBarMouseDown=!1)}return e.onMounted(()=>{if(p.value){const b=p.value,i=n.isY?"yOpacity":"xOpacity";b.addEventListener("mouseenter",()=>{t.value[i]=n.opt.scrollBarConfig.opacity,t.value[n.isY?"xOpacity":"yOpacity"]=0,t.value.scrollBarEnter=!0}),b.addEventListener("mouseleave",()=>{t.value.scrollBarMouseDown||(t.value.scrollBarEnter=!1,t.value[i]=0)}),k(b,d,a,h)}}),(b,i)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"scrollBarRef",ref:p,style:e.normalizeStyle(c.value)},null,4))}}),V=(o,m,n,r)=>{e.nextTick(()=>{const t=r.value;if(t){const f=t.offsetWidth,c=t.offsetHeight,{rulerConfig:p}=o,{bgColor:s,fontFamily:a,fontSize:d,lineColor:h,fontColor:b}=p;if(f>0&&c>0){const i=t.getContext("2d");i.clearRect(0,0,f,c),s&&(i.save(),i.fillStyle=s,i.fillRect(0,0,f,c),i.restore());const y=n?p.yRulerWidth:p.xRulerHeight,{translateX:L,translateY:v,scale:l}=m,u=n?v:L,x=E(l),C=x*l,g=window.devicePixelRatio,B=-u,S=Math.floor(B/C),O=Math.floor(((n?c:f)-u)/C);i.save(),i.fillStyle=h,i.font=`${d*g}px ${a}`,i.translate(.5,.5),i.scale(1/g,1/g),n?i.fillRect((y-1)*g,0,1,c*g):i.fillRect(0,(y-1)*g,f*g,1);for(let M=S;M<=O;M++){i.fillStyle=h;const w=(u+M*C)*g;let _=y/4;M%10===0?_=y*4/5:M%5===0&&(_=y/3),n?i.fillRect((y-_)*g,w,_*g,1):(i.fillRect(w,(y-_)*g,1,_*g),M%10===0&&(i.fillStyle=b,i.fillText(String(M*x),w+2*g,(y+8-_)*g)))}if(i.restore(),n){i.font=`${d}px ${a}`,i.fillStyle=h;let M=S;for(;M<=O;)if(M%10)M++;else{i.save();const w=u+M*C+y/2;i.translate(w+y/5,w-y*6/5),i.rotate(Math.PI/2),i.fillText(String(M*x),y*4/5,w),M+=10,i.restore()}}}}})},G=(o,m,n)=>{const r=e.computed(()=>P(o.value.positionLineConfig[m?"adsorptionYList":"adsorptionXList"])),t=e.reactive(r.value);p(0);function f(d,h=!0){const b=t.indexOf(d);h&&b===-1&&t.push(d),!h&&b>-1&&t.splice(b,1),h&&P(t)}function c(d,h=!0){Array.isArray(d)?d.forEach(b=>f(b,h)):f(d,h),n(t)}function p(d){c(d)}function s(d){c(d,!1)}e.watch(()=>r.value,(d,h)=>{P(d),d.join(",")!==P(t).join(",")&&((h==null?void 0:h.length)>0&&s(h),p(d))});const a=e.computed(()=>m?o.value.canvasHeight:o.value.canvasWidth);return e.watch(()=>a.value,(d,h)=>{h!==void 0&&s(h),p(d)},{immediate:!0}),{adsorptionList:t,modifyAdsorptionList:c}},U=(o,m,n,r,t,f,c)=>{let p=1;const s=e.reactive([]);let a=-1,d=!1;function h(i){if(d&&a>-1){i.preventDefault();const{xRulerHeight:y,yRulerWidth:L}=o.value.rulerConfig,v=s[a],l=(t?i.pageY:i.pageX)-v.start,u=v.startTranslate+l,x=u>(t?y:L),C=X(r.value,u,t),g=j(n,r.value,o.value.positionLineConfig.adsorptionGap,u,C,t);s[a].showTip=x,s[a].translate=g.translate,s[a].coordinate=g.coordinate}}function b(){if(!d||a<0)return;d=!1;const i=s[a],{width:y,height:L}=m.value,{xRulerHeight:v,yRulerWidth:l}=o.value.rulerConfig;if(i.translate<=(t?v:l)||i.translate>=(t?L:y))delete s[a];else{const u=j(n,r.value,o.value.positionLineConfig.adsorptionGap,i.translate,i.coordinate,t);s[a].translate=u.translate,s[a].coordinate=u.coordinate,c()}a=-1}return e.onMounted(()=>{if(f.value){let i=function(L){const v=F(y),l=t?L.pageY:L.pageX,u=l-(t?v.y:v.x),x={startTranslate:u,translate:u,start:l,id:p,coordinate:X(r.value,u,t),showTip:!1,show:!0};a=p,s[p++]=x,d=!0};const y=f.value;k(y,i,h,b)}}),{positionLineMap:s}},J={t:"1737358597390",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4475",width:"128",height:"128"},Q=["fill"],Z=e.defineComponent({__name:"RemoveIcon",props:{fillColor:String},setup(o){return(m,n)=>(e.openBlock(),e.createElementBlock("svg",J,[e.createElementVNode("path",{d:"M555.096563 512.000978L894.74651 172.351031a29.254124 29.254124 0 0 0 8.626944-20.779801c0-16.210984-13.14293-29.350001-29.350001-29.350001a29.244341 29.244341 0 0 0-20.752407 8.597594l-0.001957-0.001957-339.679297 339.677341L173.918321 130.822736a29.256081 29.256081 0 0 0-20.756321-8.601507c-16.209027 0-29.351957 13.140974-29.351957 29.350001a29.252167 29.252167 0 0 0 8.59955 20.754364l339.677341 339.677341-339.679298 339.677341a29.248254 29.248254 0 0 0-8.59955 20.752407c0 16.209027 13.14293 29.348044 29.351957 29.348044 8.108427 0 15.445927-3.2872 20.756321-8.601507l339.673428-339.671471 339.679297 339.679298 0.001957-0.001957a29.252167 29.252167 0 0 0 20.752407 8.597594c16.20707 0 29.350001-13.139017 29.350001-29.350001 0-8.120167-3.300897-15.465494-8.626944-20.7798L555.096563 512.000978z",fill:o.fillColor,"p-id":"4476"},null,8,Q)]))}}),ee=(o,m,n,r,t,f,c,p,s)=>{let a=!1;const d=e.reactive({});function h(v){c.value.showTip=v}function b(v){if(!a)return;const l=(t?v.pageY:v.pageX)-c.value.start,u=c.value.startTranslate+l,x=X(r.value,u,t),C=j(n.value,r.value,o.value.positionLineConfig.adsorptionGap,u,x,t);c.value.coordinate=C.coordinate,c.value.translate=C.translate}function i(v){a=!0,c.value.showTip=!0;const l=t?v.pageY:v.pageX;c.value.start=l,c.value.startTranslate=Y(r.value,c.value.coordinate,t)}function y(){if(!a)return;a=!1;const{translate:v,id:l}=c.value,{width:u,height:x}=m.value,{xRulerHeight:C,yRulerWidth:g}=o.value.rulerConfig;if(v<=(t?C:g)||v>=(t?x:u))p(l);else{const B=j(n.value,r.value,o.value.positionLineConfig.adsorptionGap,v,c.value.coordinate,t);c.value.coordinate=B.coordinate,c.value.translate=B.translate,s()}}function L(){d.show=!1,document.removeEventListener("click",L)}return e.onMounted(()=>{if(f.value){const v=f.value;v.addEventListener("mouseenter",()=>{h(!0)}),v.addEventListener("mouseleave",()=>{a||h(!1)}),v.addEventListener("contextmenu",l=>{l.preventDefault();let u=l.pageX+10,x=l.pageY-(t?20:10);d.top=x,d.left=u,d.show=!0,document.addEventListener("click",L)}),k(v,i,b,y)}}),{removeIconInfo:d}},te=((o,m)=>{const n=o.__vccOpts||o;for(const[r,t]of m)n[r]=t;return n})(e.defineComponent({__name:"PositionLine",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},transformInfo:{type:Object,required:!0},lineInfo:{type:Object,required:!0},adsorptionList:{type:Array,required:!0}},emits:["removePositionLine","positionLineChange"],setup(o,{emit:m}){const n=o,{lineInfo:r,adsorptionList:t,transformInfo:f,opt:c,containerInfo:p}=e.toRefs(n),s=e.computed(()=>c.value.positionLineConfig.padding),a=e.computed(()=>2*s.value+1),d=e.computed(()=>c.value.positionLineConfig.removeIcon||Z),h=e.computed(()=>Y(f.value,r.value.coordinate,n.isY)),b=e.computed(()=>{const{width:S,height:O}=p.value,{isY:M}=n,w=M?`translate(0, ${h.value}px)`:`translate(${h.value}px, 0)`;return{display:r.value.show?"block":"none",width:(M?S:a.value)+"px",height:(M?a.value:O)+"px",cursor:M?"row-resize":"col-resize",top:(M?-s.value:0)+"px",left:(M?0:-s.value)+"px",transform:w,zIndex:n.opt.positionLineConfig.zIndex}}),i=e.computed(()=>{const{isY:S}=n;return{width:S?"100%":"1px",height:S?"1px":"100%",backgroundColor:c.value.positionLineConfig.lineColor,top:(S?s.value:0)+"px",left:(S?0:s.value)+"px"}}),y=e.ref({}),L=e.computed(()=>{const{isY:S}=n,{width:O,height:M}=p.value,{tipWidth:w,tipHeight:_}=y.value;let R,z;return w&&_?(z=S?"50%":(h.value+a.value+w>=O?-w:a.value)+"px",R=S?(h.value+a.value+_>=M?-_:a.value)+"px":"50%"):(z=S?"50%":a.value+"px",R=S?a.value+"px":"50%"),{padding:"5px",lineHeight:"18px",minWidth:"80px",backgroundColor:"rgba(0,0,0,.8)",color:"#fff",fontSize:"12px",borderRadius:"4px",userSelect:"none",textAlign:"center",left:z,top:R,transform:S?"translate(-50%, 0)":"translate(0, -50%)",visibility:r.value.showTip?"visible":"hidden"}}),v=e.ref(null),l=m;function u(S){l("removePositionLine",S)}function x(){l("positionLineChange")}const{removeIconInfo:C}=ee(c,p,t,f,n.isY,v,r,u,x),g=e.computed(()=>({top:C.top+"px",left:C.left+"px"})),B=e.ref(null);return e.onMounted(()=>{if(B.value){const S=B.value,O=S.offsetWidth,M=S.offsetHeight;y.value.tipWidth=O,y.value.tipHeight=M}}),(S,O)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",{ref_key:"positionLineRef",ref:v,class:"scale-ruler_position-line",style:e.normalizeStyle(b.value)},[e.createElementVNode("div",{class:"scale-ruler_position-line_inner",style:e.normalizeStyle(i.value)},null,4),e.createElementVNode("div",{class:"scale-ruler_position-line_tip",style:e.normalizeStyle(L.value),ref_key:"tipRef",ref:B},e.toDisplayString((o.isY?"Y":"X")+": "+ +e.unref(r).coordinate.toFixed(2)+" px"),5)],4),e.withDirectives(e.createVNode(e.unref(d),{class:"scale-ruler_position-line_remove",style:e.normalizeStyle(g.value),"fill-color":e.unref(c).positionLineConfig.removeIconFillColor,onClick:O[0]||(O[0]=M=>u(e.unref(r).id))},null,8,["style","fill-color"]),[[e.vShow,e.unref(C).show]])],64))}}),[["__scopeId","data-v-6845710d"]]),ne=["width","height"],D=e.defineComponent({__name:"Ruler",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},transformInfo:{type:Object,required:!0}},emits:["adsorptionLineChange","positionLineChange"],setup(o,{expose:m,emit:n}){const r=o,{opt:t,transformInfo:f,containerInfo:c}=e.toRefs(r),p=e.computed(()=>{const{isY:g,containerInfo:B,opt:S}=r;return{width:g?S.rulerConfig.yRulerWidth:B.width,height:g?B.height:S.rulerConfig.xRulerHeight}}),s=e.computed(()=>({position:"absolute",left:0,top:0,zIndex:r.opt.rulerConfig.zIndex+(r.isY?0:1)})),a=e.ref();e.watch([()=>r.containerInfo,()=>r.transformInfo],()=>{V(r.opt,r.transformInfo,r.isY,a)},{deep:!0});const d=n;function h(g){d("adsorptionLineChange",g,!r.isY)}const{adsorptionList:b,modifyAdsorptionList:i}=G(t,!r.isY,h),{positionLineMap:y}=U(t,c,b,f,!r.isY,a,L);function L(){const g=y.filter(B=>!!B.show).map(B=>B.coordinate);d("positionLineChange",g,!r.isY)}function v(g){delete y[g],L()}function l(){Object.keys(y).forEach(g=>{v(g)}),L()}function u(g=!0){Object.keys(y).forEach(B=>{y[B].show=g}),L()}const x=e.ref(!0);function C(g=!0){x.value=g,u(g)}return m({modifyAdsorptionList:i,removeAllPositionLine:l,togglePositionLine:u,toggleRuler:C}),(g,B)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("canvas",{ref_key:"rulerRef",ref:a,style:e.normalizeStyle(s.value),width:p.value.width,height:p.value.height},null,12,ne),[[e.vShow,x.value]]),r.opt.usePositionLine?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass("position-line-"+(r.isY?"x":"y"))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.keys(e.unref(y)),S=>(e.openBlock(),e.createBlock(te,{key:S,opt:r.opt,"is-y":!r.isY,"transform-info":r.transformInfo,"container-info":r.containerInfo,"line-info":e.unref(y)[S],"adsorption-list":e.unref(b),onRemovePositionLine:v,onPositionLineChange:L},null,8,["opt","is-y","transform-info","container-info","line-info","adsorption-list"]))),128))],2)):e.createCommentVNode("",!0)],64))}});function oe(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var I,$;function re(){if($)return I;$=1;var o=function(u){return m(u)&&!n(u)};function m(l){return!!l&&typeof l=="object"}function n(l){var u=Object.prototype.toString.call(l);return u==="[object RegExp]"||u==="[object Date]"||f(l)}var r=typeof Symbol=="function"&&Symbol.for,t=r?Symbol.for("react.element"):60103;function f(l){return l.$$typeof===t}function c(l){return Array.isArray(l)?[]:{}}function p(l,u){return u.clone!==!1&&u.isMergeableObject(l)?L(c(l),l,u):l}function s(l,u,x){return l.concat(u).map(function(C){return p(C,x)})}function a(l,u){if(!u.customMerge)return L;var x=u.customMerge(l);return typeof x=="function"?x:L}function d(l){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(l).filter(function(u){return Object.propertyIsEnumerable.call(l,u)}):[]}function h(l){return Object.keys(l).concat(d(l))}function b(l,u){try{return u in l}catch{return!1}}function i(l,u){return b(l,u)&&!(Object.hasOwnProperty.call(l,u)&&Object.propertyIsEnumerable.call(l,u))}function y(l,u,x){var C={};return x.isMergeableObject(l)&&h(l).forEach(function(g){C[g]=p(l[g],x)}),h(u).forEach(function(g){i(l,g)||(b(l,g)&&x.isMergeableObject(u[g])?C[g]=a(g,x)(l[g],u[g],x):C[g]=p(u[g],x))}),C}function L(l,u,x){x=x||{},x.arrayMerge=x.arrayMerge||s,x.isMergeableObject=x.isMergeableObject||o,x.cloneUnlessOtherwiseSpecified=p;var C=Array.isArray(u),g=Array.isArray(l),B=C===g;return B?C?x.arrayMerge(l,u,x):y(l,u,x):p(u,x)}L.all=function(u,x){if(!Array.isArray(u))throw new Error("first argument should be an array");return u.reduce(function(C,g){return L(C,g,x)},{})};var v=L;return I=v,I}var ie=re();const q=oe(ie),T={scale:1,canScale:!0,maxScale:10,minScale:.1,autoCenter:!0,autoScale:!0,containerAutoSize:!1,containerWidth:1e3,containerHeight:500,containerXPadding:800,containerYPadding:800,canvasWidth:1920,canvasHeight:1e3,proxyScaleKey:!0,useScrollBar:!0,useRuler:!0,usePositionLine:!0,positionLineConfig:{lineColor:"#6CC6A7",padding:3,adsorptionGap:4,zIndex:300,adsorptionXList:[],adsorptionYList:[],useRemove:!0,removeIcon:"",removeIconFillColor:"#525252"},canvasStyle:{},scrollBarConfig:{bgColor:"#000000",opacity:.4,zIndex:500,barSize:8},rulerConfig:{yRulerWidth:20,xRulerHeight:20,bgColor:"#f5f5f5",fontColor:"#797B80",fontSize:10,fontFamily:"Arial",lineColor:"#797B80",zIndex:400}},ae=function(){const o={};for(const m in T){const n=T[m];typeof n=="object"&&n!==null?o[m]=()=>n:o[m]=n}return o}(),le=(o,m)=>{const n=e.reactive({width:0,height:0,originWidth:0,originHeight:0});function r(p,s){new ResizeObserver(d=>{for(const h of d)if(h.target===s){const b=s.offsetWidth,i=s.offsetHeight;(b!==n.originWidth||i!==n.originHeight)&&t(p,s)}}).observe(s)}function t(p,s,a=!1){const d=p.value;d.containerAutoSize?(n.width=s.offsetWidth,n.height=s.offsetHeight,n.originWidth=n.width,n.originHeight=n.height,a&&r(p,s)):(n.width=d.containerWidth,n.height=d.containerHeight);const h=getComputedStyle(s);h.boxSizing==="border-box"&&(n.width-=parseFloat(h.borderLeftWidth)+parseFloat(h.borderRightWidth),n.height-=parseFloat(h.borderTopWidth)+parseFloat(h.borderBottomWidth)),h.position==="static"&&(n.position="relative")}e.onMounted(()=>{const p=m.value;p&&t(o,p,!0)});const f=e.computed(()=>({width:n.width,height:n.height})),c=e.computed(()=>{const p=o.value,s={overflow:"hidden"};return p.containerAutoSize||(s.width=n.width+"px",s.height=n.height+"px"),n.position&&(s.position=n.position),s});return{containerInfo:f,containerStyle:c}},se=(o,m,n,r)=>{const t=e.reactive({});return e.watch(()=>m.value,()=>{const f=o.value;let c=t.translateX||0,p=t.translateY||0,s=0,a=0,{scale:d}=f;const{autoCenter:h,autoScale:b}=f,{width:i,height:y}=m.value;if(b){const l=(i-160)/f.canvasWidth,u=(y-2*80)/f.canvasHeight;d=Math.min(l,u)}t.scale=d;let L=0,v=0;s=f.canvasWidth*d,a=f.canvasHeight*d,h&&(L=Math.floor((i-s)/2),v=Math.floor((y-a)/2),t.translateX=L,t.translateY=v),f.scale!==d&&n(d),(c!==L||p||v)&&r(L,v)},{deep:!0}),{transformInfo:t}},ce=(o,m,n)=>({scrollBarInfo:e.computed(()=>{const t=o.value,{width:f,height:c}=m.value,{translateX:p,translateY:s,scale:a}=n,d=t.canvasWidth*a+2*t.containerXPadding,h=t.canvasHeight*a+2*t.containerYPadding,b=f<d,i=c<h,y=b||i,L=f*((t.containerXPadding-p)/d),v=c*((t.containerYPadding-s)/h),l=f/d*f,u=c/h*c;return{totalHeight:h,totalWidth:d,left:L,top:v,width:l,height:u,isYLarge:i,isXLarge:b,isLarge:y}})});function N(o,m,n){const r=o.value,{containerXPadding:t,containerYPadding:f,canvasWidth:c,canvasHeight:p}=r,s=c*n,a=p*n,{width:d,height:h}=m.value,b=Math.max((d-s)/2,t),i=Math.max((h-a)/2,f),y=s+2*t>d?d-(s+t):b,L=a+2*f>h?h-(a+f):i;return{maxTranslateX:b,maxTranslateY:i,minTranslateX:y,minTranslateY:L}}const fe=(o,m,n)=>({boundaryInfo:e.computed(()=>N(o,m,n.scale))}),A=(o,m,n,r,t,f)=>{const c=o.value;if(!c.canScale)return;let{translateX:p,translateY:s,scale:a}=n,d=p,h=s;r=Math.min(Math.max(r,c.minScale),c.maxScale);const b=r-a,i=N(o,m,r);p-=b*c.canvasWidth/2,s-=b*c.canvasHeight/2,p=Math.max(Math.min(p,i.maxTranslateX),i.minTranslateX),s=Math.max(Math.min(s,i.maxTranslateY),i.minTranslateY),n.scale=r,n.translateX=p,n.translateY=s,t(r),(d!==p||h!==s)&&f(p,s)},ue=(o,m,n,r,t)=>{o.value.proxyScaleKey&&document.addEventListener("keydown",f=>{if(o.value.canScale){const c=f.keyCode;if((f.metaKey||f.ctrlKey)&&(c===187||c===189)){f.preventDefault();const p=n.scale+(c===187?.05:-.05);A(o,m,n,p,r,t)}}})},pe=(o,m,n,r,t,f,c,p,s)=>{let a=null;Object.assign(c,{xOpacity:0,yOpacity:0,scrollBarMouseDown:!1,scrollBarEnter:!1}),e.onMounted(()=>{t.value&&t.value.addEventListener("wheel",d=>{if(o.value.canScale)if(d.metaKey||d.ctrlKey){d.preventDefault();const h=-1*d.deltaY/100,b=n.scale+h;A(o,m,n,b,p,s)}else{if(!f.value.isLarge||c.scrollBarMouseDown)return;d.preventDefault();let{translateX:h,translateY:b}=n;a&&clearTimeout(a);const i=-d.deltaX,y=-d.deltaY;let L="";const{opacity:v=.4}=o.value.scrollBarConfig,{isXLarge:l,isYLarge:u}=f.value,{maxTranslateX:x,minTranslateX:C,maxTranslateY:g,minTranslateY:B}=r.value;l&&Math.abs(i)>Math.abs(y)&&(h+=i,h=Math.max(Math.min(h,x),C),c.xOpacity=v,c.yOpacity=0,n.translateX=h,L="x"),u&&Math.abs(y)>Math.abs(i)&&(L="y",b+=y,b=Math.max(Math.min(b,g),B),c.yOpacity=v,c.xOpacity=0,n.translateY=b),L&&(s(n.translateX,n.translateY),a=setTimeout(()=>{c.scrollBarEnter||(c[L==="y"?"yOpacity":"xOpacity"]=0)},1e3))}})})};return e.defineComponent({__name:"index",props:e.mergeDefaults({scale:{},minScale:{},maxScale:{},canScale:{type:Boolean},autoCenter:{type:Boolean},autoScale:{type:Boolean},containerAutoSize:{type:Boolean},containerWidth:{},containerHeight:{},containerXPadding:{},containerYPadding:{},canvasWidth:{},canvasHeight:{},proxyScaleKey:{type:Boolean},useScrollBar:{type:Boolean},useRuler:{type:Boolean},usePositionLine:{type:Boolean},positionLineConfig:{},canvasStyle:{},scrollBarConfig:{},rulerConfig:{}},ae),emits:["update:scale","onScale","onMove","adsorptionLineChange","positionLineChange"],setup(o,{expose:m,emit:n}){const r=o,t=e.ref(q(T,r,{arrayMerge:W})),f=n,c=e.ref(null),{containerInfo:p,containerStyle:s}=le(t,c),{transformInfo:a}=se(t,p,i,y),{boundaryInfo:d}=fe(t,p,a),{scrollBarInfo:h}=ce(t,p,a),b=e.reactive({});e.watch(()=>a.scale,w=>{if(w){if(!b.scale){const _={scale:w,translateX:a.translateX,translateY:a.translateY};Object.assign(b,_)}f("update:scale",w)}}),e.watch(()=>r,()=>{t.value=q(t.value,r,{arrayMerge:W})},{deep:!0});function i(w){f("onScale",w)}function y(w,_){f("onMove",w,_)}function L(w){A(t,p,a,w,i,y)}e.watch(()=>t.value.scale,w=>{w!==a.scale&&L(w)}),ue(t,p,a,i,y);const v=e.reactive({});pe(t,p,a,d,c,h,v,i,y);function l(w,_){f("adsorptionLineChange",w,_)}function u(w,_){f("positionLineChange",w,_)}function x(){Object.assign(a,b)}const C=e.ref(null),g=e.ref(null);function B(){t.value.useRuler&&(C.value&&C.value.removeAllPositionLine(),g.value&&g.value.removeAllPositionLine())}function S(w=!0){t.value.useRuler&&(C.value&&C.value.toggleRuler(w),g.value&&g.value.toggleRuler(w))}function O(w=!0){t.value.useRuler&&(C.value&&C.value.togglePositionLine(w),g.value&&g.value.togglePositionLine(w))}function M(w,_=!0,R=!1){t.value.useRuler&&(R&&C.value&&C.value.modifyAdsorptionList(w,_),!R&&g.value&&g.value.modifyAdsorptionList(w,_))}return m({reset:x,changeScale:L,removeAllPositionLine:B,showRuler(){S()},hideRuler(){S(!1)},showAllPositionLine(){O()},hideAllPositionLine(){O(!1)},addAdsorptionLine(w,_=!1){M(w,!0,_)},removeAdsorptionLine(w,_=!1){M(w,!1,_)}}),(w,_)=>(e.openBlock(),e.createElementBlock("div",{class:"scale-ruler",ref_key:"container",ref:c,style:e.normalizeStyle(e.unref(s))},[t.value.useRuler?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(D,{ref_key:"xRuler",ref:C,opt:t.value,"container-info":e.unref(p),"transform-info":e.unref(a),onAdsorptionLineChange:l,onPositionLineChange:u},null,8,["opt","container-info","transform-info"]),e.createVNode(D,{ref_key:"yRuler",ref:g,"is-y":"",opt:t.value,"container-info":e.unref(p),"transform-info":e.unref(a),onAdsorptionLineChange:l,onPositionLineChange:u},null,8,["opt","container-info","transform-info"])],64)):e.createCommentVNode("",!0),e.createVNode(K,{"container-info":e.unref(p),opt:t.value,"transform-info":e.unref(a)},{default:e.withCtx(()=>[e.renderSlot(w.$slots,"default")]),_:3},8,["container-info","opt","transform-info"]),e.unref(h).isXLarge?(e.openBlock(),e.createBlock(H,{key:1,opt:t.value,"container-info":e.unref(p),"scroll-bar-info":e.unref(h),"global-info":v,"transform-info":e.unref(a),onOnMove:y},null,8,["opt","container-info","scroll-bar-info","global-info","transform-info"])):e.createCommentVNode("",!0),e.unref(h).isYLarge?(e.openBlock(),e.createBlock(H,{key:2,opt:t.value,"container-info":e.unref(p),"scroll-bar-info":e.unref(h),"global-info":v,"transform-info":e.unref(a),onOnMove:y,"is-y":""},null,8,["opt","container-info","scroll-bar-info","global-info","transform-info"])):e.createCommentVNode("",!0)],4))}})});
