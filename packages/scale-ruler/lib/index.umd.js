(function(e,E){typeof exports=="object"&&typeof module<"u"?module.exports=E(require("vue")):typeof define=="function"&&define.amd?define(["vue"],E):(e=typeof globalThis<"u"?globalThis:e||self,e.ScaleRuler=E(e.Vue))})(this,function(e){"use strict";const E=l=>l<=.25?40:l<=.5?20:l<=1?10:l<=2?5:l<=4?2:1,$=l=>{const v=l.getBoundingClientRect(),n=v.top+(document.body.scrollTop||document.documentElement.scrollTop),a=v.left+(document.body.scrollLeft||document.documentElement.scrollLeft);return{top:n,left:a}},X=(l,v,n)=>{const{scale:a,translateX:t,translateY:f}=l;return(v-(n?f:t))/a},Y=(l,v,n)=>{const{scale:a,translateX:t,translateY:f}=l,c=v*a;return(n?f:t)+c};function _(l,v,n,a,t,f){const c={coordinate:t,translate:a},i=l.length;if(i>0){let r=0;for(;r<i;){const d=l[r];if(Math.abs(t-d)<=Math.max(n,n/v.scale)){c.coordinate=d,c.translate=Y(v,d,f);break}else if(d>t)break;r++}}return c}function W(l,v){return v}function P(l){return l.sort((v,n)=>v-n)}const F=e.defineComponent({__name:"CanvasPanel",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},setup(l){const v=l,n=e.computed(()=>{var a,t;return{position:"absolute",left:0,top:0,width:((a=v.opt)==null?void 0:a.canvasWidth)+"px",height:((t=v.opt)==null?void 0:t.canvasHeight)+"px",transformOrigin:"0 0",transform:`translate(${v.transformInfo.translateX}px, ${v.transformInfo.translateY}px) scale(${v.transformInfo.scale})`,...v.opt.canvasStyle}});return(a,t)=>(e.openBlock(),e.createElementBlock("div",{ref:"canvasPanel",style:e.normalizeStyle(n.value)},[e.renderSlot(a.$slots,"default")],4))}});function T(l,v,n,a){if(!l)return;function t(f){f.preventDefault(),typeof n=="function"&&n(f)}l.addEventListener("mousedown",f=>{f.button===0&&(f.preventDefault(),typeof v=="function"&&v(f),document.addEventListener("mousemove",t))}),document.addEventListener("mouseup",f=>{document.removeEventListener("mousemove",t),typeof a=="function"&&a(f)})}const z=e.defineComponent({__name:"ScrollBar",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},scrollBarInfo:{type:Object,required:!0},globalInfo:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},emits:["onMove"],setup(l,{emit:v}){const n=l,a=v,{globalInfo:t,transformInfo:f}=e.toRefs(n),c=e.computed(()=>{const{opt:m,scrollBarInfo:o,isY:b}=n,{scrollBarConfig:x}=m,L={position:"absolute",borderRadius:"4px",backgroundColor:x.bgColor,opacity:n.globalInfo[b?"yOpacity":"xOpacity"]||0,transition:"opacity 300ms",cursor:"pointer",zIndex:x.zIndex,width:(b?x.barSize:o.width)+"px",height:(b?o.height:x.barSize)+"px"};return b?(L.top=o.top+"px",L.right=0):(L.left=o.left+"px",L.bottom=0),L}),i=e.ref(null),r={};function d(m){if(m.preventDefault(),!t.value.scrollBarMouseDown)return;let{translateX:o,translateY:b}=f.value;const x=n.scrollBarInfo,{width:L,height:s}=n.containerInfo;if(n.isY){const y=m.pageY-r.startY;let u=r.top+y;u=Math.min(Math.max(0,u),s-x.height);const S=u*x.totalHeight/s;b=n.opt.containerYPadding-S,f.value.translateY=b}else{const y=m.pageX-r.startX;let u=r.left+y;u=Math.min(Math.max(0,u),L-x.width);const S=u*x.totalWidth/L;o=n.opt.containerXPadding-S,f.value.translateX=o}a("onMove",f.value.translateX,f.value.translateY)}function p(m){t.value.scrollBarMouseDown=!0,r.startX=m.pageX,r.startY=m.pageY,r.left=n.scrollBarInfo.left,r.top=n.scrollBarInfo.top}function g(){t.value.scrollBarMouseDown&&(t.value.scrollBarMouseDown=!1)}return e.onMounted(()=>{if(i.value){const m=i.value,o=n.isY?"yOpacity":"xOpacity";m.addEventListener("mouseenter",()=>{t.value[o]=n.opt.scrollBarConfig.opacity,t.value[n.isY?"xOpacity":"yOpacity"]=0,t.value.scrollBarEnter=!0}),m.addEventListener("mouseleave",()=>{t.value.scrollBarMouseDown||(t.value.scrollBarEnter=!1,t.value[o]=0)}),T(m,p,d,g)}}),(m,o)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"scrollBarRef",ref:i,style:e.normalizeStyle(c.value)},null,4))}}),K=(l,v,n,a)=>{e.nextTick(()=>{const t=a.value;if(t){const f=t.offsetWidth,c=t.offsetHeight,{rulerConfig:i}=l,{bgColor:r,fontFamily:d,fontSize:p,lineColor:g,fontColor:m}=i;if(f>0&&c>0){const o=t.getContext("2d");o.clearRect(0,0,f,c),r&&(o.save(),o.fillStyle=r,o.fillRect(0,0,f,c),o.restore());const b=n?i.yRulerWidth:i.xRulerHeight,{translateX:x,translateY:L,scale:s}=v,y=n?L:x,u=E(s),S=u*s,h=window.devicePixelRatio,B=-y,R=Math.floor(B/S),j=Math.floor(((n?c:f)-y)/S);o.save(),o.fillStyle=g,o.font=`${p*h}px ${d}`,o.translate(.5,.5),o.scale(1/h,1/h),n?o.fillRect((b-1)*h,0,1,c*h):o.fillRect(0,(b-1)*h,f*h,1);for(let M=R;M<=j;M++){o.fillStyle=g;const C=(y+M*S)*h;let w=b/4;M%10===0?w=b*4/5:M%5===0&&(w=b/3),n?o.fillRect((b-w)*h,C,w*h,1):(o.fillRect(C,(b-w)*h,1,w*h),M%10===0&&(o.fillStyle=m,o.fillText(String(M*u),C+2*h,(b+8-w)*h)))}if(o.restore(),n){o.font=`${p}px ${d}`,o.fillStyle=g;let M=R;for(;M<=j;)if(M%10)M++;else{o.save();const C=y+M*S+b/2;o.translate(C+b/5,C-b*6/5),o.rotate(Math.PI/2),o.fillText(String(M*u),b*4/5,C),M+=10,o.restore()}}}}})},G=(l,v,n)=>{const a=e.computed(()=>P(l.value.positionLineConfig[v?"adsorptionYList":"adsorptionXList"])),t=e.reactive(a.value);i(0);function f(p,g=!0){const m=t.indexOf(p);g&&m===-1&&t.push(p),!g&&m>-1&&t.splice(m,1),g&&P(t)}function c(p,g=!0){Array.isArray(p)?p.forEach(m=>f(m,g)):f(p,g),n(t)}function i(p){c(p)}function r(p){c(p,!1)}e.watch(()=>a.value,(p,g)=>{P(p),p.join(",")!==P(t).join(",")&&((g==null?void 0:g.length)>0&&r(g),i(p))});const d=e.computed(()=>v?l.value.canvasHeight:l.value.canvasWidth);return e.watch(()=>d.value,(p,g)=>{g!==void 0&&r(g),i(p)},{immediate:!0}),{adsorptionList:t,modifyAdsorptionList:c}},U=(l,v,n,a,t,f)=>{let c=1;const i=e.reactive([]);let r=-1,d=!1;function p(m){if(d&&r>-1){m.preventDefault();const{xRulerHeight:o,yRulerWidth:b}=l.value.rulerConfig,x=i[r],L=(t?m.pageY:m.pageX)-x.start,s=x.startTranslate+L,y=s>(t?o:b),u=X(a.value,s,t),S=_(n,a.value,l.value.positionLineConfig.adsorptionGap,s,u,t);i[r].showTip=y,i[r].translate=S.translate,i[r].coordinate=S.coordinate}}function g(){if(!d||r<0)return;d=!1;const m=i[r],{width:o,height:b}=v.value,{xRulerHeight:x,yRulerWidth:L}=l.value.rulerConfig;if(m.translate<=(t?x:L)||m.translate>=(t?b:o))delete i[r];else{const s=_(n,a.value,l.value.positionLineConfig.adsorptionGap,m.translate,m.coordinate,t);i[r].showTip=!1,i[r].translate=s.translate,i[r].coordinate=s.coordinate}r=-1}return e.onMounted(()=>{if(f.value){let m=function(b){const x=$(o),L=t?b.pageY:b.pageX,s=L-(t?x.top:x.left),y={startTranslate:s,translate:s,start:L,id:c,coordinate:X(a.value,s,t),showTip:!1,show:!0};r=c,i[c++]=y,d=!0};const o=f.value;T(o,m,p,g)}}),{positionLineMap:i}},V=(l,v,n,a,t,f,c,i)=>{let r=!1;function d(o){c.value.showTip=o}function p(o){if(!r)return;const b=(t?o.pageY:o.pageX)-c.value.start,x=c.value.startTranslate+b,L=X(a.value,x,t),s=_(n.value,a.value,l.value.positionLineConfig.adsorptionGap,x,L,t);c.value.coordinate=s.coordinate,c.value.translate=s.translate}function g(o){r=!0,c.value.showTip=!0;const b=t?o.pageY:o.pageX;c.value.start=b,c.value.startTranslate=Y(a.value,c.value.coordinate,t)}function m(){if(!r)return;r=!1;const{translate:o,id:b}=c.value,{width:x,height:L}=v.value,{xRulerHeight:s,yRulerWidth:y}=l.value.rulerConfig;if(o<=(t?s:y)||o>=(t?L:x))i(b);else{d(!1);const u=_(n.value,a.value,l.value.positionLineConfig.adsorptionGap,o,c.value.coordinate,t);c.value.coordinate=u.coordinate,c.value.translate=u.translate}}e.onMounted(()=>{if(f.value){const o=f.value;o.addEventListener("mouseenter",()=>{d(!0)}),o.addEventListener("mouseleave",()=>{r||d(!1)}),T(o,g,p,m)}})},J=e.defineComponent({__name:"PositionLine",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},transformInfo:{type:Object,required:!0},lineInfo:{type:Object,required:!0},adsorptionList:{type:Array,required:!0}},emits:["remove-position-line"],setup(l,{emit:v}){const n=l,{lineInfo:a,adsorptionList:t,transformInfo:f,opt:c,containerInfo:i}=e.toRefs(n),r=e.computed(()=>c.value.positionLineConfig.padding),d=e.computed(()=>2*r.value+1),p=e.computed(()=>Y(f.value,a.value.coordinate,n.isY)),g=e.computed(()=>{const{width:u,height:S}=i.value,{isY:h}=n,B=h?`translate(0, ${p.value}px)`:`translate(${p.value}px, 0)`;return{display:a.value.show?"block":"none",position:"absolute",width:(h?u:d.value)+"px",height:(h?d.value:S)+"px",cursor:h?"row-resize":"col-resize",top:(h?-r.value:0)+"px",left:(h?0:-r.value)+"px",transform:B,zIndex:n.opt.positionLineConfig.zIndex}}),m=e.computed(()=>{const{isY:u}=n;return{position:"absolute",width:u?"100%":"1px",height:u?"1px":"100%",backgroundColor:c.value.positionLineConfig.lineColor,top:(u?r.value:0)+"px",left:(u?0:r.value)+"px"}}),o=e.ref({}),b=e.computed(()=>{const{isY:u}=n,{width:S,height:h}=i.value,{tipWidth:B,tipHeight:R}=o.value;let j,M;return B&&R?(M=u?"50%":(p.value+d.value+B>=S?-B:d.value)+"px",j=u?(p.value+d.value+R>=h?-R:d.value)+"px":"50%"):(M=u?"50%":d.value+"px",j=u?d.value+"px":"50%"),{position:"absolute",padding:"5px",lineHeight:"18px",minWidth:"80px",backgroundColor:"rgba(0,0,0,.8)",color:"#fff",fontSize:"12px",borderRadius:"4px",userSelect:"none",textAlign:"center",left:M,top:j,transform:u?"translate(-50%, 0)":"translate(0, -50%)",visibility:a.value.showTip?"visible":"hidden"}}),x=e.ref(null),L=v;function s(u){L("remove-position-line",u)}V(c,i,t,f,n.isY,x,a,s);const y=e.ref(null);return e.onMounted(()=>{if(y.value){const u=y.value,S=u.offsetWidth,h=u.offsetHeight;o.value.tipWidth=S,o.value.tipHeight=h}}),(u,S)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"positionLineRef",ref:x,class:"scale-ruler_position-line",style:e.normalizeStyle(g.value)},[e.createElementVNode("div",{class:"scale-ruler_position-line_inner",style:e.normalizeStyle(m.value)},null,4),e.createElementVNode("div",{class:"scale-ruler_position-line_tip",style:e.normalizeStyle(b.value),ref_key:"tipRef",ref:y},e.toDisplayString((l.isY?"Y":"X")+": "+ +e.unref(a).coordinate.toFixed(2)+" px"),5)],4))}}),Q=["width","height"],H=e.defineComponent({__name:"Ruler",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},transformInfo:{type:Object,required:!0}},emits:["adsorptionLineChange"],setup(l,{expose:v,emit:n}){const a=l,{opt:t,transformInfo:f,containerInfo:c}=e.toRefs(a),i=e.computed(()=>{const{isY:h,containerInfo:B,opt:R}=a;return{width:h?R.rulerConfig.yRulerWidth:B.width,height:h?B.height:R.rulerConfig.xRulerHeight}}),r=e.computed(()=>({position:"absolute",left:0,top:0,zIndex:a.opt.rulerConfig.zIndex+(a.isY?0:1)})),d=e.ref();e.watch([()=>a.containerInfo,()=>a.transformInfo],()=>{K(a.opt,a.transformInfo,a.isY,d)},{deep:!0});const p=n;function g(h){p("adsorptionLineChange",h,!a.isY)}const{adsorptionList:m,modifyAdsorptionList:o}=G(t,!a.isY,g),{positionLineMap:b}=U(t,c,m,f,!a.isY,d);function x(h){delete b[h]}function L(){Object.keys(b).forEach(h=>{x(h)})}function s(h=!0){Object.keys(b).forEach(B=>{b[B].show=h})}const y=e.ref(!0);function u(h=!0){y.value=h,s(h)}function S(){return b.filter(h=>!!h).map(h=>h.coordinate).sort((h,B)=>h-B)}return v({modifyAdsorptionList:o,removeAllPositionLine:L,togglePositionLine:s,toggleRuler:u,getPositionLineList:S}),(h,B)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("canvas",{ref_key:"rulerRef",ref:d,style:e.normalizeStyle(r.value),width:i.value.width,height:i.value.height},null,12,Q),[[e.vShow,y.value]]),a.opt.usePositionLine?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass("position-line-"+(a.isY?"x":"y"))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.keys(e.unref(b)),R=>(e.openBlock(),e.createBlock(J,{key:R,opt:a.opt,"is-y":!a.isY,"transform-info":a.transformInfo,"container-info":a.containerInfo,"line-info":e.unref(b)[R],"adsorption-list":e.unref(m),onRemovePositionLine:x},null,8,["opt","is-y","transform-info","container-info","line-info","adsorption-list"]))),128))],2)):e.createCommentVNode("",!0)],64))}});function Z(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var A,I;function ee(){if(I)return A;I=1;var l=function(y){return v(y)&&!n(y)};function v(s){return!!s&&typeof s=="object"}function n(s){var y=Object.prototype.toString.call(s);return y==="[object RegExp]"||y==="[object Date]"||f(s)}var a=typeof Symbol=="function"&&Symbol.for,t=a?Symbol.for("react.element"):60103;function f(s){return s.$$typeof===t}function c(s){return Array.isArray(s)?[]:{}}function i(s,y){return y.clone!==!1&&y.isMergeableObject(s)?x(c(s),s,y):s}function r(s,y,u){return s.concat(y).map(function(S){return i(S,u)})}function d(s,y){if(!y.customMerge)return x;var u=y.customMerge(s);return typeof u=="function"?u:x}function p(s){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(s).filter(function(y){return Object.propertyIsEnumerable.call(s,y)}):[]}function g(s){return Object.keys(s).concat(p(s))}function m(s,y){try{return y in s}catch{return!1}}function o(s,y){return m(s,y)&&!(Object.hasOwnProperty.call(s,y)&&Object.propertyIsEnumerable.call(s,y))}function b(s,y,u){var S={};return u.isMergeableObject(s)&&g(s).forEach(function(h){S[h]=i(s[h],u)}),g(y).forEach(function(h){o(s,h)||(m(s,h)&&u.isMergeableObject(y[h])?S[h]=d(h,u)(s[h],y[h],u):S[h]=i(y[h],u))}),S}function x(s,y,u){u=u||{},u.arrayMerge=u.arrayMerge||r,u.isMergeableObject=u.isMergeableObject||l,u.cloneUnlessOtherwiseSpecified=i;var S=Array.isArray(y),h=Array.isArray(s),B=S===h;return B?S?u.arrayMerge(s,y,u):b(s,y,u):i(y,u)}x.all=function(y,u){if(!Array.isArray(y))throw new Error("first argument should be an array");return y.reduce(function(S,h){return x(S,h,u)},{})};var L=x;return A=L,A}var te=ee();const N=Z(te),O={scale:1,canScale:!0,maxScale:10,minScale:.1,autoCenter:!0,autoScale:!0,containerAutoSize:!1,containerWidth:1e3,containerHeight:500,containerXPadding:800,containerYPadding:800,canvasWidth:1920,canvasHeight:1e3,proxyScaleKey:!0,useScrollBar:!0,useRuler:!0,usePositionLine:!0,positionLineConfig:{lineColor:"#6CC6A7",padding:3,adsorptionGap:4,zIndex:300,adsorptionXList:[],adsorptionYList:[]},canvasStyle:{},scrollBarConfig:{bgColor:"#000000",opacity:.4,zIndex:500,barSize:8},rulerConfig:{yRulerWidth:20,xRulerHeight:20,bgColor:"#f5f5f5",fontColor:"#797B80",fontSize:10,fontFamily:"Arial",lineColor:"#797B80",zIndex:400}};(function(){const l={};for(const v in O){const n=O[v];typeof n=="object"&&n!==null?l[v]=()=>n:l[v]=n}return l})();const ne={scale:{type:Number,default:O.scale},minScale:{type:Number,default:O.minScale},maxScale:{type:Number,default:O.maxScale},canScale:{type:Boolean,default:O.canScale},autoCenter:{type:Boolean,default:O.autoCenter},autoScale:{type:Boolean,default:O.autoScale},containerAutoSize:{type:Boolean,default:O.containerAutoSize},containerWidth:{type:Number,default:O.containerWidth},containerHeight:{type:Number,default:O.containerHeight},containerXPadding:{type:Number,default:O.containerXPadding},containerYPadding:{type:Number,default:O.containerYPadding},canvasWidth:{type:Number,default:O.canvasWidth},canvasHeight:{type:Number,default:O.canvasHeight},proxyScaleKey:{type:Boolean,default:O.proxyScaleKey},useScrollBar:{type:Boolean,default:O.useScrollBar},useRuler:{type:Boolean,default:O.useRuler},usePositionLine:{type:Boolean,default:O.usePositionLine},positionLineConfig:{type:Object,default:O.positionLineConfig},canvasStyle:{type:Object,default:O.canvasStyle},scrollBarConfig:{type:Object,default:O.scrollBarConfig},rulerConfig:{type:Object,default:O.rulerConfig}},oe=(l,v)=>{const n=e.reactive({width:0,height:0,originWidth:0,originHeight:0});function a(i,r){new ResizeObserver(p=>{for(const g of p)if(g.target===r){const m=r.offsetWidth,o=r.offsetHeight;(m!==n.originWidth||o!==n.originHeight)&&t(i,r)}}).observe(r)}function t(i,r,d=!1){const p=i.value;p.containerAutoSize?(n.width=r.offsetWidth,n.height=r.offsetHeight,n.originWidth=n.width,n.originHeight=n.height,d&&a(i,r)):(n.width=p.containerWidth,n.height=p.containerHeight);const g=getComputedStyle(r);g.boxSizing==="border-box"&&(n.width-=parseFloat(g.borderLeftWidth)+parseFloat(g.borderRightWidth),n.height-=parseFloat(g.borderTopWidth)+parseFloat(g.borderBottomWidth)),g.position==="static"&&(n.position="relative")}e.onMounted(()=>{const i=v.value;i&&t(l,i,!0)});const f=e.computed(()=>({width:n.width,height:n.height})),c=e.computed(()=>{const i=l.value,r={overflow:"hidden"};return i.containerAutoSize||(r.width=n.width+"px",r.height=n.height+"px"),n.position&&(r.position=n.position),r});return{containerInfo:f,containerStyle:c}},re=(l,v,n,a)=>{const t=e.reactive({});return e.watch(()=>v.value,()=>{const f=l.value;let c=t.translateX||0,i=t.translateY||0,r=0,d=0,{scale:p}=f;const{autoCenter:g,autoScale:m}=f,{width:o,height:b}=v.value;if(m){const s=(o-160)/f.canvasWidth,y=(b-2*80)/f.canvasHeight;p=Math.min(s,y)}t.scale=p;let x=0,L=0;r=f.canvasWidth*p,d=f.canvasHeight*p,g&&(x=Math.floor((o-r)/2),L=Math.floor((b-d)/2),t.translateX=x,t.translateY=L),f.scale!==p&&n(p),(c!==x||i||L)&&a(x,L)},{deep:!0}),{transformInfo:t}},ae=(l,v,n)=>({scrollBarInfo:e.computed(()=>{const t=l.value,{width:f,height:c}=v.value,{translateX:i,translateY:r,scale:d}=n,p=t.canvasWidth*d+2*t.containerXPadding,g=t.canvasHeight*d+2*t.containerYPadding,m=f<p,o=c<g,b=m||o,x=f*((t.containerXPadding-i)/p),L=c*((t.containerYPadding-r)/g),s=f/p*f,y=c/g*c;return{totalHeight:g,totalWidth:p,left:x,top:L,width:s,height:y,isYLarge:o,isXLarge:m,isLarge:b}})});function D(l,v,n){const a=l.value,{containerXPadding:t,containerYPadding:f,canvasWidth:c,canvasHeight:i}=a,r=c*n,d=i*n,{width:p,height:g}=v.value,m=Math.max((p-r)/2,t),o=Math.max((g-d)/2,f),b=r+2*t>p?p-(r+t):m,x=d+2*f>g?g-(d+f):o;return{maxTranslateX:m,maxTranslateY:o,minTranslateX:b,minTranslateY:x}}const ie=(l,v,n)=>({boundaryInfo:e.computed(()=>D(l,v,n.scale))}),k=(l,v,n,a,t,f)=>{const c=l.value;if(!c.canScale)return;let{translateX:i,translateY:r,scale:d}=n,p=i,g=r;a=Math.min(Math.max(a,c.minScale),c.maxScale);const m=a-d,o=D(l,v,a);i-=m*c.canvasWidth/2,r-=m*c.canvasHeight/2,i=Math.max(Math.min(i,o.maxTranslateX),o.minTranslateX),r=Math.max(Math.min(r,o.maxTranslateY),o.minTranslateY),n.scale=a,n.translateX=i,n.translateY=r,t(a),(p!==i||g!==r)&&f(i,r)},le=(l,v,n,a,t)=>{l.value.proxyScaleKey&&document.addEventListener("keydown",f=>{if(l.value.canScale){const c=f.keyCode;if((f.metaKey||f.ctrlKey)&&(c===187||c===189)){f.preventDefault();const i=n.scale+(c===187?.05:-.05);k(l,v,n,i,a,t)}}})},se=(l,v,n,a,t,f,c,i,r)=>{let d=null;Object.assign(c,{xOpacity:0,yOpacity:0,scrollBarMouseDown:!1,scrollBarEnter:!1}),e.onMounted(()=>{t.value&&t.value.addEventListener("wheel",p=>{if(l.value.canScale)if(p.metaKey||p.ctrlKey){p.preventDefault();const g=-1*p.deltaY/100,m=n.scale+g;k(l,v,n,m,i,r)}else{if(!f.value.isLarge||c.scrollBarMouseDown)return;p.preventDefault();let{translateX:g,translateY:m}=n;d&&clearTimeout(d);const o=-p.deltaX,b=-p.deltaY;let x="";const{opacity:L=.4}=l.value.scrollBarConfig,{isXLarge:s,isYLarge:y}=f.value,{maxTranslateX:u,minTranslateX:S,maxTranslateY:h,minTranslateY:B}=a.value;s&&Math.abs(o)>Math.abs(b)&&(g+=o,g=Math.max(Math.min(g,u),S),c.xOpacity=L,c.yOpacity=0,n.translateX=g,x="x"),y&&Math.abs(b)>Math.abs(o)&&(x="y",m+=b,m=Math.max(Math.min(m,h),B),c.yOpacity=L,c.xOpacity=0,n.translateY=m),x&&(r(n.translateX,n.translateY),d=setTimeout(()=>{c.scrollBarEnter||(c[x==="y"?"yOpacity":"xOpacity"]=0)},1e3))}})})};return e.defineComponent({__name:"index",props:ne,emits:["update:scale","onScale","onMove","adsorptionLineChange"],setup(l,{expose:v,emit:n}){const a=l,t=e.ref(N(O,a,{arrayMerge:W})),f=n,c=e.ref(null),{containerInfo:i,containerStyle:r}=oe(t,c),{transformInfo:d}=re(t,i,o,b),{boundaryInfo:p}=ie(t,i,d),{scrollBarInfo:g}=ae(t,i,d),m=e.reactive({});e.watch(()=>d.scale,C=>{if(C){if(!m.scale){const w={scale:C,translateX:d.translateX,translateY:d.translateY};Object.assign(m,w)}f("update:scale",C)}}),e.watch(()=>a,()=>{t.value=N(t.value,a,{arrayMerge:W})},{deep:!0});function o(C){f("onScale",C)}function b(C,w){f("onMove",C,w)}function x(C){k(t,i,d,C,o,b)}e.watch(()=>t.value.scale,C=>{C!==d.scale&&x(C)}),le(t,i,d,o,b);const L=e.reactive({});se(t,i,d,p,c,g,L,o,b);function s(C,w){f("adsorptionLineChange",C,w)}function y(){Object.assign(d,m)}const u=e.ref(null),S=e.ref(null);function h(){t.value.useRuler&&(u.value&&u.value.removeAllPositionLine(),S.value&&S.value.removeAllPositionLine())}function B(C=!0){t.value.useRuler&&(u.value&&u.value.toggleRuler(C),S.value&&S.value.toggleRuler(C))}function R(C=!0){t.value.useRuler&&(u.value&&u.value.togglePositionLine(C),S.value&&S.value.togglePositionLine(C))}function j(C,w=!0,q=!1){t.value.useRuler&&(q&&u.value&&u.value.modifyAdsorptionList(C,w),!q&&S.value&&S.value.modifyAdsorptionList(C,w))}function M(C){let w=[];return t.value.useRuler&&(C?u.value&&(w=u.value.getPositionLineList()):S.value&&(w=S.value.getPositionLineList())),w}return v({reset:y,changeScale:x,removeAllPositionLine:h,showRuler(){B()},hideRuler(){B(!1)},showAllPositionLine(){R()},hideAllPositionLine(){R(!1)},addAdsorptionLine(C,w=!1){j(C,!0,w)},removeAdsorptionLine(C,w=!1){j(C,!1,w)},getPositionLineList:M}),(C,w)=>(e.openBlock(),e.createElementBlock("div",{class:"scale-ruler",ref_key:"container",ref:c,style:e.normalizeStyle(e.unref(r))},[t.value.useRuler?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(H,{ref_key:"xRuler",ref:u,opt:t.value,"container-info":e.unref(i),"transform-info":e.unref(d),onAdsorptionLineChange:s},null,8,["opt","container-info","transform-info"]),e.createVNode(H,{ref_key:"yRuler",ref:S,"is-y":"",opt:t.value,"container-info":e.unref(i),"transform-info":e.unref(d),onAdsorptionLineChange:s},null,8,["opt","container-info","transform-info"])],64)):e.createCommentVNode("",!0),e.createVNode(F,{"container-info":e.unref(i),opt:t.value,"transform-info":e.unref(d)},{default:e.withCtx(()=>[e.renderSlot(C.$slots,"default")]),_:3},8,["container-info","opt","transform-info"]),e.unref(g).isXLarge?(e.openBlock(),e.createBlock(z,{key:1,opt:t.value,"container-info":e.unref(i),"scroll-bar-info":e.unref(g),"global-info":L,"transform-info":e.unref(d),onOnMove:b},null,8,["opt","container-info","scroll-bar-info","global-info","transform-info"])):e.createCommentVNode("",!0),e.unref(g).isYLarge?(e.openBlock(),e.createBlock(z,{key:2,opt:t.value,"container-info":e.unref(i),"scroll-bar-info":e.unref(g),"global-info":L,"transform-info":e.unref(d),onOnMove:b,"is-y":""},null,8,["opt","container-info","scroll-bar-info","global-info","transform-info"])):e.createCommentVNode("",!0)],4))}})});
