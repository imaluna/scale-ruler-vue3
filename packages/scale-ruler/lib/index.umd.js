(function(e,Y){typeof exports=="object"&&typeof module<"u"?module.exports=Y(require("vue")):typeof define=="function"&&define.amd?define(["vue"],Y):(e=typeof globalThis<"u"?globalThis:e||self,e.ScaleRuler=Y(e.Vue))})(this,function(e){"use strict";const Y=e.defineComponent({__name:"CanvasPanel",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},canvasInfo:{type:Object,required:!0}},setup(a){const r=a,t=e.computed(()=>{var l,n;return{position:"absolute",left:0,top:0,width:((l=r.opt)==null?void 0:l.canvasWidth)+"px",height:((n=r.opt)==null?void 0:n.canvasHeight)+"px",transition:"transform 300ms",transformOrigin:"0 0",transform:`translate(${r.canvasInfo.translateX}px, ${r.canvasInfo.translateY}px) scale(${r.canvasInfo.scale})`,...r.opt.canvasStyle}});return(l,n)=>(e.openBlock(),e.createElementBlock("div",{ref:"canvasPanel",style:e.normalizeStyle(t.value)},null,4))}}),X=e.defineComponent({__name:"ScrollBar",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},scrollBarInfo:{type:Object,required:!0},scrollBarOpacity:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},setup(a){const r=a,{scrollBarOpacity:t,transformInfo:l}=e.toRefs(r),n=e.computed(()=>{const{opt:d,scrollBarInfo:f,isY:p}=r,{scrollBarConfig:y}=d,x={position:"absolute",borderRadius:"4px",backgroundColor:y.bgColor,opacity:r.scrollBarOpacity[p?"yOpacity":"xOpacity"]||0,transition:"opacity 300ms",cursor:"pointer",zIndex:y.zIndex,width:(p?y.barSize:f.width)+"px",height:(p?f.height:y.barSize)+"px"};return p?(x.top=f.top+"px",x.right=0):(x.left=f.left+"px",x.bottom=0),x}),i=e.ref(null),o={};function h(d){if(d.preventDefault(),!t.value.isMouseDown)return;let{translateX:f,translateY:p}=l.value;const y=r.scrollBarInfo,{width:x,height:c}=r.containerInfo;if(r.isY){const b=d.pageY-o.startY;let v=o.top+b;v=Math.min(Math.max(0,v),c-y.height);const B=v*y.totalHeight/c;p=r.opt.containerYPadding-B,l.value.translateY=p}else{const b=d.pageX-o.startX;let v=o.left+b;v=Math.min(Math.max(0,v),c-y.height);const B=v*y.totalWidth/c;f=r.opt.containerXPadding-B,l.value.translateX=f}}return e.onMounted(()=>{if(i.value){const d=i.value,f=r.isY?"yOpacity":"xOpacity";d.addEventListener("mouseenter",()=>{t.value[f]=r.opt.scrollBarConfig.opacity,t.value[r.isY?"xOpacity":"yOpacity"]=0,t.value.isMouseEnter=!0}),d.addEventListener("mouseleave",()=>{t.value.isMouseEnter=!1,t.value[f]=0}),d.addEventListener("mousedown",p=>{t.value.isMouseDown=!0,o.startX=p.pageX,o.startY=p.pageY,o.left=r.scrollBarInfo.left,o.top=r.scrollBarInfo.top,document.addEventListener("mousemove",h)}),document.addEventListener("mouseup",()=>{t.value.isMouseDown=!1,document.removeEventListener("mousemove",h)})}}),(d,f)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"scrollBarRef",ref:i,style:e.normalizeStyle(n.value)},null,4))}}),H=a=>a<=.25?40:a<=.5?20:a<=1?10:a<=2?5:a<=4?2:1,A=(a,r,t,l)=>{e.nextTick(()=>{const n=l.value;if(n){const i=n.offsetWidth,o=n.offsetHeight,{rulerConfig:h}=a,{bgColor:d,fontFamily:f,fontSize:p,lineColor:y,fontColor:x}=h;if(i>0&&o>0){const c=n.getContext("2d");c.clearRect(0,0,i,o),d&&(c.save(),c.fillStyle=d,c.fillRect(0,0,i,o),c.restore());const b=t?h.yRulerWidth:h.xRulerHeight,{translateX:v,translateY:B,scale:s}=r,u=t?B:v,g=H(s),S=g*s,m=window.devicePixelRatio,I=-u,z=Math.floor(I/S),L=Math.floor(((t?o:i)-u)/S);c.save(),c.fillStyle=y,c.font=`${p*m}px ${f}`,c.translate(.5,.5),c.scale(1/m,1/m),t?c.fillRect((b-1)*m,0,1,o*m):c.fillRect(0,(b-1)*m,i*m,1);for(let M=z;M<=L;M++){c.fillStyle=y;const w=(u+M*S)*m;let C=b/4;M%10===0?C=b*4/5:M%5===0&&(C=b/3),t?c.fillRect((b-C)*m,w,C*m,1):(c.fillRect(w,(b-C)*m,1,C*m),M%10===0&&(c.fillStyle=x,c.fillText(String(M*g),w+2*m,(b+8-C)*m)))}if(c.restore(),t){c.font=`${p}px ${f}`;let M=z;for(;M<=L;)if(M%10)M++;else{c.save();const w=u+M*S+b/2;c.translate(w+b/5,w-b*6/5),c.rotate(Math.PI/2),c.fillText(String(M*g),b*4/5,w),M+=10,c.restore()}}}}})},k=["width","height"],E=e.defineComponent({__name:"Ruler",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},canvasInfo:{type:Object,required:!0},isY:{type:Boolean,default:!1}},setup(a){const r=a,t=e.computed(()=>{const{isY:i,containerInfo:o,opt:h}=r;return{width:i?h.rulerConfig.yRulerWidth:o.width,height:i?o.height:h.rulerConfig.xRulerHeight}}),l=e.computed(()=>({position:"absolute",left:0,top:0,zIndex:r.opt.rulerConfig.zIndex+(r.isY?0:1)})),n=e.ref();return e.watch([()=>r.containerInfo,()=>r.canvasInfo],()=>{A(r.opt,r.canvasInfo,r.isY,n)},{deep:!0}),(i,o)=>(e.openBlock(),e.createElementBlock("canvas",{ref_key:"rulerRef",ref:n,style:e.normalizeStyle(l.value),width:t.value.width,height:t.value.height},null,12,k))}});function q(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var _,R;function D(){if(R)return _;R=1;var a=function(u){return r(u)&&!t(u)};function r(s){return!!s&&typeof s=="object"}function t(s){var u=Object.prototype.toString.call(s);return u==="[object RegExp]"||u==="[object Date]"||i(s)}var l=typeof Symbol=="function"&&Symbol.for,n=l?Symbol.for("react.element"):60103;function i(s){return s.$$typeof===n}function o(s){return Array.isArray(s)?[]:{}}function h(s,u){return u.clone!==!1&&u.isMergeableObject(s)?v(o(s),s,u):s}function d(s,u,g){return s.concat(u).map(function(S){return h(S,g)})}function f(s,u){if(!u.customMerge)return v;var g=u.customMerge(s);return typeof g=="function"?g:v}function p(s){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(s).filter(function(u){return Object.propertyIsEnumerable.call(s,u)}):[]}function y(s){return Object.keys(s).concat(p(s))}function x(s,u){try{return u in s}catch{return!1}}function c(s,u){return x(s,u)&&!(Object.hasOwnProperty.call(s,u)&&Object.propertyIsEnumerable.call(s,u))}function b(s,u,g){var S={};return g.isMergeableObject(s)&&y(s).forEach(function(m){S[m]=h(s[m],g)}),y(u).forEach(function(m){c(s,m)||(x(s,m)&&g.isMergeableObject(u[m])?S[m]=f(m,g)(s[m],u[m],g):S[m]=h(u[m],g))}),S}function v(s,u,g){g=g||{},g.arrayMerge=g.arrayMerge||d,g.isMergeableObject=g.isMergeableObject||a,g.cloneUnlessOtherwiseSpecified=h;var S=Array.isArray(u),m=Array.isArray(s),I=S===m;return I?S?g.arrayMerge(s,u,g):b(s,u,g):h(u,g)}v.all=function(u,g){if(!Array.isArray(u))throw new Error("first argument should be an array");return u.reduce(function(S,m){return v(S,m,g)},{})};var B=v;return _=B,_}var $=D();const T=q($),j={scale:1,canScale:!0,maxScale:10,minScale:.1,autoCenter:!0,autoScale:!0,containerAutoSize:!1,containerWidth:1e3,containerHeight:500,containerXPadding:80,containerYPadding:80,canvasWidth:1920,canvasHeight:2e3,proxyScaleKey:!0,useScrollBar:!0,useRuler:!0,usePositionLine:!0,positionLineConfig:{lineColor:"#24aa61",padding:3,adsorptionXList:[],adsorptionYList:[],adsorptionGap:4,zIndex:300},canvasStyle:{},scrollBarConfig:{bgColor:"#000000",opacity:.4,zIndex:500,barSize:8},rulerConfig:{yRulerWidth:30,xRulerHeight:30,bgColor:"#efefef",fontColor:"#000000",fontSize:12,fontFamily:"Arial",lineColor:"#000000",zIndex:400},onScale:()=>{},onMove:()=>{}},F=function(){const a={};for(const r in j){const t=j[r];typeof t=="object"&&t!==null?a[r]=()=>t:a[r]=t}return a}(),O=e.reactive({width:0,height:0,originWidth:0,originHeight:0});function K(a){new ResizeObserver(t=>{for(const l of t)if(l.target===a){const n=a.offsetWidth,i=a.offsetHeight;n!==O.originWidth||O.originHeight}}).observe(a)}const N=(a,r)=>{e.onMounted(()=>{const n=a.value,i=r.value;if(i){n.containerAutoSize?(O.width=i.offsetWidth,O.height=i.offsetHeight,O.originWidth=O.width,O.originHeight=O.height,K(i)):(O.width=n.containerWidth,O.height=n.containerHeight);const o=getComputedStyle(i);o.boxSizing==="border-box"&&(O.width-=parseFloat(o.borderLeftWidth)+parseFloat(o.borderRightWidth),O.height-=parseFloat(o.borderTopWidth)+parseFloat(o.borderBottomWidth)),o.position==="static"&&(O.position="relative")}});const t=e.computed(()=>({width:O.width,height:O.height})),l=e.computed(()=>{const n=a.value,i={overflow:"hidden"};return n.containerAutoSize||(i.width=O.width+"px",i.height=O.height+"px"),O.position&&(i.position=O.position),i});return{containerInfo:t,containerStyle:l}},V=(a,r)=>{const t=e.reactive({});return e.watch(()=>r.value,()=>{const l=a.value;let n=0,i=0,{scale:o}=l;const{autoCenter:h,autoScale:d}=l,{width:f,height:p}=r.value;if(d){const c=(f-2*l.containerXPadding)/l.canvasWidth,b=(p-2*l.containerYPadding)/l.canvasHeight;o=Math.min(c,b)}t.scale=o;let y=0,x=0;n=l.canvasWidth*o,i=l.canvasHeight*o,h&&(y=Math.floor((f-n)/2),x=Math.floor((p-i)/2),t.translateX=y,t.translateY=x)},{deep:!0}),{transformInfo:t}},U=(a,r,t)=>({scrollBarInfo:e.computed(()=>{console.log(t,"--transformInfo-33");const n=a.value,{width:i,height:o}=r.value,{translateX:h,translateY:d,scale:f}=t,p=n.canvasWidth*f+2*n.containerXPadding,y=n.canvasHeight*f+2*n.containerYPadding,x=i<p,c=o<y,b=x||c,v=i*((n.containerXPadding-h)/p),B=o*((n.containerYPadding-d)/p),s=i/p*i,u=o/y*o;return{totalHeight:y,totalWidth:p,left:v,top:B,width:s,height:u,isYLarge:c,isXLarge:x,isLarge:b}})});function W(a,r,t){const l=a.value,{containerXPadding:n,containerYPadding:i,canvasWidth:o,canvasHeight:h}=l,d=o*t,f=h*t,{width:p,height:y}=r.value,x=Math.max((p-d)/2,n),c=Math.max((y-f)/2,i),b=d+2*n>p?p-(d+n):x,v=f+2*i>y?y-(f+i):c;return{maxTranslateX:x,maxTranslateY:c,minTranslateX:b,minTranslateY:v}}const G=(a,r,t)=>({boundaryInfo:e.computed(()=>W(a,r,t.scale))}),P=(a,r,t,l)=>{const n=a.value;let{translateX:i,translateY:o,scale:h}=t;l=Math.min(Math.max(l,n.minScale),n.maxScale);const d=l-h,f=W(a,r,l);i-=d*n.canvasWidth/2,o-=d*n.canvasHeight/2,i=Math.max(Math.min(i,f.maxTranslateX),f.minTranslateX),o=Math.max(Math.min(o,f.maxTranslateY),f.minTranslateY),t.scale=l,t.translateX=i,t.translateY=o},J=(a,r,t)=>{a.value.proxyScaleKey&&document.addEventListener("keydown",l=>{if(a.value.canScale){const n=l.keyCode;if((l.metaKey||l.ctrlKey)&&(n===187||n===189)){l.preventDefault();const i=t.scale+(n===187?.05:-.05);P(a,r,t,i)}}})},Q=(a,r,t,l,n,i)=>{let o=null;const h=e.reactive({xOpacity:0,yOpacity:0,isMouseDown:!1,isMouseEnter:!1});return e.onMounted(()=>{n.value&&n.value.addEventListener("wheel",d=>{if(d.metaKey||d.ctrlKey){d.preventDefault();const f=-1*d.deltaY/100,p=t.scale+f;P(a,r,t,p)}else{if(console.log(h,"--scrollBarOpacity-1-"),!i.value.isLarge||h.isMouseDown)return;d.preventDefault();let{translateX:f,translateY:p}=t;o&&clearTimeout(o);const y=-d.deltaX,x=-d.deltaY;let c="";const{opacity:b=.4}=a.value.scrollBarConfig,{isXLarge:v,isYLarge:B}=i.value,{maxTranslateX:s,minTranslateX:u,maxTranslateY:g,minTranslateY:S}=l.value;v&&Math.abs(y)>Math.abs(x)&&(f+=y,f=Math.max(Math.min(f,s),u),h.xOpacity=b,h.yOpacity=0,t.translateX=f,c="x"),B&&Math.abs(x)>Math.abs(y)&&(c="y",p+=x,p=Math.max(Math.min(p,g),S),h.yOpacity=b,h.xOpacity=0,t.translateY=p),c&&(o=setTimeout(()=>{h.isMouseEnter||(h[c==="y"?"yOpacity":"xOpacity"]=0)},1e3))}})}),{scrollBarOpacity:h}};return e.defineComponent({__name:"ScaleRuler",props:e.mergeDefaults({scale:{},minScale:{},maxScale:{},canScale:{type:Boolean},autoCenter:{type:Boolean},autoScale:{type:Boolean},containerAutoSize:{type:Boolean},containerWidth:{},containerHeight:{},containerXPadding:{},containerYPadding:{},canvasWidth:{},canvasHeight:{},proxyScaleKey:{type:Boolean},useScrollBar:{type:Boolean},useRuler:{type:Boolean},usePositionLine:{type:Boolean},positionLineConfig:{},canvasStyle:{},scrollBarConfig:{},rulerConfig:{},onScale:{type:Function},onMove:{type:Function}},F),setup(a){const r=a,t=e.ref(T(j,r)),l=e.ref(null),{containerInfo:n,containerStyle:i}=N(t,l),{transformInfo:o}=V(t,n),{boundaryInfo:h}=G(t,n,o),d=e.computed(()=>Object.assign({},o,h.value)),{scrollBarInfo:f}=U(t,n,o),p=e.reactive({}),y=e.watch(()=>d.value,c=>{if(c.scale){const b={scale:c.scale,translateX:c.translateX,translateY:c.translateY};p.scale||Object.assign(p,b),y()}});e.watch(()=>r,()=>{t.value=T(t.value,r)},{deep:!0}),J(t,n,o);const{scrollBarOpacity:x}=Q(t,n,o,h,l,f);return console.log(x,"--scrollBarOpacity-"),(c,b)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:l,style:e.normalizeStyle(e.unref(i))},[t.value.useRuler?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(E,{opt:t.value,"container-info":e.unref(n),"canvas-info":d.value},null,8,["opt","container-info","canvas-info"]),e.createVNode(E,{"is-y":"",opt:t.value,"container-info":e.unref(n),"canvas-info":d.value},null,8,["opt","container-info","canvas-info"])],64)):e.createCommentVNode("",!0),e.createVNode(Y,{"container-info":e.unref(n),opt:t.value,"canvas-info":d.value,"transform-info":e.unref(o)},{default:e.withCtx(()=>[e.renderSlot(c.$slots,"default")]),_:3},8,["container-info","opt","canvas-info","transform-info"]),e.unref(f).isXLarge?(e.openBlock(),e.createBlock(X,{key:1,opt:t.value,"container-info":e.unref(n),"scroll-bar-info":e.unref(f),"scroll-bar-opacity":e.unref(x),"transform-info":e.unref(o)},null,8,["opt","container-info","scroll-bar-info","scroll-bar-opacity","transform-info"])):e.createCommentVNode("",!0),e.unref(f).isYLarge?(e.openBlock(),e.createBlock(X,{key:2,opt:t.value,"container-info":e.unref(n),"scroll-bar-info":e.unref(f),"scroll-bar-opacity":e.unref(x),"transform-info":e.unref(o),"is-y":""},null,8,["opt","container-info","scroll-bar-info","scroll-bar-opacity","transform-info"])):e.createCommentVNode("",!0)],4))}})});
