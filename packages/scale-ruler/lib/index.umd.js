(function(e,E){typeof exports=="object"&&typeof module<"u"?module.exports=E(require("vue")):typeof define=="function"&&define.amd?define(["vue"],E):(e=typeof globalThis<"u"?globalThis:e||self,e.ScaleRuler=E(e.Vue))})(this,function(e){"use strict";const E=l=>l<=.25?40:l<=.5?20:l<=1?10:l<=2?5:l<=4?2:1,$=l=>{const v=l.getBoundingClientRect(),n=v.top+(document.body.scrollTop||document.documentElement.scrollTop),a=v.left+(document.body.scrollLeft||document.documentElement.scrollLeft);return{top:n,left:a}},X=(l,v,n)=>{const{scale:a,translateX:t,translateY:f}=l;return(v-(n?f:t))/a},Y=(l,v,n)=>{const{scale:a,translateX:t,translateY:f}=l,c=v*a;return(n?f:t)+c};function _(l,v,n,a,t,f){const c={coordinate:t,translate:a},i=l.length;if(i>0){let r=0;for(;r<i;){const d=l[r];if(Math.abs(t-d)<=Math.max(n,n/v.scale)){c.coordinate=d,c.translate=Y(v,d,f);break}else if(d>t)break;r++}}return c}function W(l,v){return v}function P(l){return l.sort((v,n)=>v-n)}const F=e.defineComponent({__name:"CanvasPanel",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},setup(l){const v=l,n=e.computed(()=>{var a,t;return{position:"absolute",left:0,top:0,width:((a=v.opt)==null?void 0:a.canvasWidth)+"px",height:((t=v.opt)==null?void 0:t.canvasHeight)+"px",transformOrigin:"0 0",transform:`translate(${v.transformInfo.translateX}px, ${v.transformInfo.translateY}px) scale(${v.transformInfo.scale})`,...v.opt.canvasStyle}});return(a,t)=>(e.openBlock(),e.createElementBlock("div",{ref:"canvasPanel",style:e.normalizeStyle(n.value)},[e.renderSlot(a.$slots,"default")],4))}});function T(l,v,n,a){if(!l)return;function t(f){f.preventDefault(),typeof n=="function"&&n(f)}l.addEventListener("mousedown",f=>{f.button===0&&(f.preventDefault(),typeof v=="function"&&v(f),document.addEventListener("mousemove",t))}),document.addEventListener("mouseup",f=>{document.removeEventListener("mousemove",t),typeof a=="function"&&a(f)})}const z=e.defineComponent({__name:"ScrollBar",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},scrollBarInfo:{type:Object,required:!0},globalInfo:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},emits:["onMove"],setup(l,{emit:v}){const n=l,a=v,{globalInfo:t,transformInfo:f}=e.toRefs(n),c=e.computed(()=>{const{opt:g,scrollBarInfo:o,isY:b}=n,{scrollBarConfig:x}=g,S={position:"absolute",borderRadius:"4px",backgroundColor:x.bgColor,opacity:n.globalInfo[b?"yOpacity":"xOpacity"]||0,transition:"opacity 300ms",cursor:"pointer",zIndex:x.zIndex,width:(b?x.barSize:o.width)+"px",height:(b?o.height:x.barSize)+"px"};return b?(S.top=o.top+"px",S.right=0):(S.left=o.left+"px",S.bottom=0),S}),i=e.ref(null),r={};function d(g){if(g.preventDefault(),!t.value.scrollBarMouseDown)return;let{translateX:o,translateY:b}=f.value;const x=n.scrollBarInfo,{width:S,height:s}=n.containerInfo;if(n.isY){const y=g.pageY-r.startY;let u=r.top+y;u=Math.min(Math.max(0,u),s-x.height);const L=u*x.totalHeight/s;b=n.opt.containerYPadding-L,f.value.translateY=b}else{const y=g.pageX-r.startX;let u=r.left+y;u=Math.min(Math.max(0,u),S-x.width);const L=u*x.totalWidth/S;o=n.opt.containerXPadding-L,f.value.translateX=o}a("onMove",f.value.translateX,f.value.translateY)}function p(g){t.value.scrollBarMouseDown=!0,r.startX=g.pageX,r.startY=g.pageY,r.left=n.scrollBarInfo.left,r.top=n.scrollBarInfo.top}function m(){t.value.scrollBarMouseDown&&(t.value.scrollBarMouseDown=!1)}return e.onMounted(()=>{if(i.value){const g=i.value,o=n.isY?"yOpacity":"xOpacity";g.addEventListener("mouseenter",()=>{t.value[o]=n.opt.scrollBarConfig.opacity,t.value[n.isY?"xOpacity":"yOpacity"]=0,t.value.scrollBarEnter=!0}),g.addEventListener("mouseleave",()=>{t.value.scrollBarMouseDown||(t.value.scrollBarEnter=!1,t.value[o]=0)}),T(g,p,d,m)}}),(g,o)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"scrollBarRef",ref:i,style:e.normalizeStyle(c.value)},null,4))}}),K=(l,v,n,a)=>{e.nextTick(()=>{const t=a.value;if(t){const f=t.offsetWidth,c=t.offsetHeight,{rulerConfig:i}=l,{bgColor:r,fontFamily:d,fontSize:p,lineColor:m,fontColor:g}=i;if(f>0&&c>0){const o=t.getContext("2d");o.clearRect(0,0,f,c),r&&(o.save(),o.fillStyle=r,o.fillRect(0,0,f,c),o.restore());const b=n?i.yRulerWidth:i.xRulerHeight,{translateX:x,translateY:S,scale:s}=v,y=n?S:x,u=E(s),L=u*s,h=window.devicePixelRatio,C=-y,R=Math.floor(C/L),j=Math.floor(((n?c:f)-y)/L);o.save(),o.fillStyle=m,o.font=`${p*h}px ${d}`,o.translate(.5,.5),o.scale(1/h,1/h),n?o.fillRect((b-1)*h,0,1,c*h):o.fillRect(0,(b-1)*h,f*h,1);for(let M=R;M<=j;M++){o.fillStyle=m;const O=(y+M*L)*h;let B=b/4;M%10===0?B=b*4/5:M%5===0&&(B=b/3),n?o.fillRect((b-B)*h,O,B*h,1):(o.fillRect(O,(b-B)*h,1,B*h),M%10===0&&(o.fillStyle=g,o.fillText(String(M*u),O+2*h,(b+8-B)*h)))}if(o.restore(),n){o.font=`${p}px ${d}`,o.fillStyle=m;let M=R;for(;M<=j;)if(M%10)M++;else{o.save();const O=y+M*L+b/2;o.translate(O+b/5,O-b*6/5),o.rotate(Math.PI/2),o.fillText(String(M*u),b*4/5,O),M+=10,o.restore()}}}}})},U=(l,v,n)=>{const a=e.computed(()=>l.value[v?"adsorptionYList":"adsorptionXList"].sort()),t=e.reactive([]);i(0),i(a.value);function f(p,m=!0){const g=t.indexOf(p);m&&g===-1&&t.push(p),!m&&g>-1&&t.splice(g,1),m&&P(t)}function c(p,m=!0){Array.isArray(p)?p.forEach(g=>f(g,m)):f(p,m),n(t)}function i(p){c(p)}function r(p){c(p,!1)}e.watch(()=>a.value,(p,m)=>{P(p),p.join(",")!==P(t).join(",")&&((m==null?void 0:m.length)>0&&r(m),i(p))});const d=e.computed(()=>v?l.value.canvasHeight:l.value.canvasWidth);return e.watch(()=>d.value,(p,m)=>{m!==void 0&&r(m),i(p)},{immediate:!0}),{adsorptionList:t,modifyAdsorptionList:c}},G=(l,v,n,a,t,f)=>{let c=1;const i=e.reactive([]);let r=-1,d=!1;function p(g){if(d&&r>-1){g.preventDefault();const{xRulerHeight:o,yRulerWidth:b}=l.value.rulerConfig,x=i[r],S=(t?g.pageY:g.pageX)-x.start,s=x.startTranslate+S,y=s>(t?o:b),u=X(a.value,s,t),L=_(n,a.value,l.value.positionLineConfig.adsorptionGap,s,u,t);i[r].showTip=y,i[r].translate=L.translate,i[r].coordinate=L.coordinate}}function m(){if(!d||r<0)return;d=!1;const g=i[r],{width:o,height:b}=v.value,{xRulerHeight:x,yRulerWidth:S}=l.value.rulerConfig;if(g.translate<=(t?x:S)||g.translate>=(t?b:o))delete i[r];else{const s=_(n,a.value,l.value.positionLineConfig.adsorptionGap,g.translate,g.coordinate,t);i[r].showTip=!1,i[r].translate=s.translate,i[r].coordinate=s.coordinate}r=-1}return e.onMounted(()=>{if(f.value){let g=function(b){const x=$(o),S=t?b.pageY:b.pageX,s=S-(t?x.top:x.left),y={startTranslate:s,translate:s,start:S,id:c,coordinate:X(a.value,s,t),showTip:!1,show:!0};r=c,i[c++]=y,d=!0};const o=f.value;T(o,g,p,m)}}),{positionLineMap:i}},V=(l,v,n,a,t,f,c,i)=>{let r=!1;function d(o){c.value.showTip=o}function p(o){if(!r)return;const b=(t?o.pageY:o.pageX)-c.value.start,x=c.value.startTranslate+b,S=X(a.value,x,t),s=_(n.value,a.value,l.value.positionLineConfig.adsorptionGap,x,S,t);c.value.coordinate=s.coordinate,c.value.translate=s.translate}function m(o){r=!0,c.value.showTip=!0;const b=t?o.pageY:o.pageX;c.value.start=b,c.value.startTranslate=Y(a.value,c.value.coordinate,t)}function g(){if(!r)return;r=!1;const{translate:o,id:b}=c.value,{width:x,height:S}=v.value,{xRulerHeight:s,yRulerWidth:y}=l.value.rulerConfig;if(o<=(t?s:y)||o>=(t?S:x))i(b);else{d(!1);const u=_(n.value,a.value,l.value.positionLineConfig.adsorptionGap,o,c.value.coordinate,t);c.value.coordinate=u.coordinate,c.value.translate=u.translate}}e.onMounted(()=>{if(f.value){const o=f.value;o.addEventListener("mouseenter",()=>{d(!0)}),o.addEventListener("mouseleave",()=>{r||d(!1)}),T(o,m,p,g)}})},J=e.defineComponent({__name:"PositionLine",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},transformInfo:{type:Object,required:!0},lineInfo:{type:Object,required:!0},adsorptionList:{type:Array,required:!0}},emits:["remove-position-line"],setup(l,{emit:v}){const n=l,{lineInfo:a,adsorptionList:t,transformInfo:f,opt:c,containerInfo:i}=e.toRefs(n),r=e.computed(()=>c.value.positionLineConfig.padding),d=e.computed(()=>2*r.value+1),p=e.computed(()=>Y(f.value,a.value.coordinate,n.isY)),m=e.computed(()=>{const{width:u,height:L}=i.value,{isY:h}=n,C=h?`translate(0, ${p.value}px)`:`translate(${p.value}px, 0)`;return{display:a.value.show?"block":"none",position:"absolute",width:(h?u:d.value)+"px",height:(h?d.value:L)+"px",cursor:h?"row-resize":"col-resize",top:(h?-r.value:0)+"px",left:(h?0:-r.value)+"px",transform:C,zIndex:n.opt.positionLineConfig.zIndex}}),g=e.computed(()=>{const{isY:u}=n;return{position:"absolute",width:u?"100%":"1px",height:u?"1px":"100%",backgroundColor:c.value.positionLineConfig.lineColor,top:(u?r.value:0)+"px",left:(u?0:r.value)+"px"}}),o=e.ref({}),b=e.computed(()=>{const{isY:u}=n,{width:L,height:h}=i.value,{tipWidth:C,tipHeight:R}=o.value;let j,M;return C&&R?(M=u?"50%":(p.value+d.value+C>=L?-C:d.value)+"px",j=u?(p.value+d.value+R>=h?-R:d.value)+"px":"50%"):(M=u?"50%":d.value+"px",j=u?d.value+"px":"50%"),{position:"absolute",padding:"5px",lineHeight:"18px",minWidth:"80px",backgroundColor:"rgba(0,0,0,.8)",color:"#fff",fontSize:"12px",borderRadius:"4px",userSelect:"none",textAlign:"center",left:M,top:j,transform:u?"translate(-50%, 0)":"translate(0, -50%)",visibility:a.value.showTip?"visible":"hidden"}}),x=e.ref(null),S=v;function s(u){S("remove-position-line",u)}V(c,i,t,f,n.isY,x,a,s);const y=e.ref(null);return e.onMounted(()=>{if(y.value){const u=y.value,L=u.offsetWidth,h=u.offsetHeight;o.value.tipWidth=L,o.value.tipHeight=h}}),(u,L)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"positionLineRef",ref:x,class:"scale-ruler_position-line",style:e.normalizeStyle(m.value)},[e.createElementVNode("div",{class:"scale-ruler_position-line_inner",style:e.normalizeStyle(g.value)},null,4),e.createElementVNode("div",{class:"scale-ruler_position-line_tip",style:e.normalizeStyle(b.value),ref_key:"tipRef",ref:y},e.toDisplayString((l.isY?"Y":"X")+": "+ +e.unref(a).coordinate.toFixed(2)+" px"),5)],4))}}),Q=["width","height"],H=e.defineComponent({__name:"Ruler",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},transformInfo:{type:Object,required:!0}},emits:["update-adsorption-list"],setup(l,{expose:v,emit:n}){const a=l,{opt:t,transformInfo:f,containerInfo:c}=e.toRefs(a),i=e.computed(()=>{const{isY:h,containerInfo:C,opt:R}=a;return{width:h?R.rulerConfig.yRulerWidth:C.width,height:h?C.height:R.rulerConfig.xRulerHeight}}),r=e.computed(()=>({position:"absolute",left:0,top:0,zIndex:a.opt.rulerConfig.zIndex+(a.isY?0:1)})),d=e.ref();e.watch([()=>a.containerInfo,()=>a.transformInfo],()=>{K(a.opt,a.transformInfo,a.isY,d)},{deep:!0});const p=n;function m(h){p("update-adsorption-list",h,!a.isY)}const{adsorptionList:g,modifyAdsorptionList:o}=U(t,!a.isY,m),{positionLineMap:b}=G(t,c,g,f,!a.isY,d);function x(h){delete b[h]}function S(){Object.keys(b).forEach(h=>{x(h)})}function s(h=!0){Object.keys(b).forEach(C=>{b[C].show=h})}const y=e.ref(!0);function u(h=!0){y.value=h,s(h)}function L(){return b.filter(h=>!!h).map(h=>h.coordinate).sort((h,C)=>h-C)}return v({modifyAdsorptionList:o,removeAllPositionLine:S,togglePositionLine:s,toggleRuler:u,getPositionLineList:L}),(h,C)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("canvas",{ref_key:"rulerRef",ref:d,style:e.normalizeStyle(r.value),width:i.value.width,height:i.value.height},null,12,Q),[[e.vShow,y.value]]),a.opt.usePositionLine?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass("position-line-"+(a.isY?"x":"y"))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.keys(e.unref(b)),R=>(e.openBlock(),e.createBlock(J,{key:R,opt:a.opt,"is-y":!a.isY,"transform-info":a.transformInfo,"container-info":a.containerInfo,"line-info":e.unref(b)[R],"adsorption-list":e.unref(g),onRemovePositionLine:x},null,8,["opt","is-y","transform-info","container-info","line-info","adsorption-list"]))),128))],2)):e.createCommentVNode("",!0)],64))}});function Z(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var A,I;function ee(){if(I)return A;I=1;var l=function(y){return v(y)&&!n(y)};function v(s){return!!s&&typeof s=="object"}function n(s){var y=Object.prototype.toString.call(s);return y==="[object RegExp]"||y==="[object Date]"||f(s)}var a=typeof Symbol=="function"&&Symbol.for,t=a?Symbol.for("react.element"):60103;function f(s){return s.$$typeof===t}function c(s){return Array.isArray(s)?[]:{}}function i(s,y){return y.clone!==!1&&y.isMergeableObject(s)?x(c(s),s,y):s}function r(s,y,u){return s.concat(y).map(function(L){return i(L,u)})}function d(s,y){if(!y.customMerge)return x;var u=y.customMerge(s);return typeof u=="function"?u:x}function p(s){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(s).filter(function(y){return Object.propertyIsEnumerable.call(s,y)}):[]}function m(s){return Object.keys(s).concat(p(s))}function g(s,y){try{return y in s}catch{return!1}}function o(s,y){return g(s,y)&&!(Object.hasOwnProperty.call(s,y)&&Object.propertyIsEnumerable.call(s,y))}function b(s,y,u){var L={};return u.isMergeableObject(s)&&m(s).forEach(function(h){L[h]=i(s[h],u)}),m(y).forEach(function(h){o(s,h)||(g(s,h)&&u.isMergeableObject(y[h])?L[h]=d(h,u)(s[h],y[h],u):L[h]=i(y[h],u))}),L}function x(s,y,u){u=u||{},u.arrayMerge=u.arrayMerge||r,u.isMergeableObject=u.isMergeableObject||l,u.cloneUnlessOtherwiseSpecified=i;var L=Array.isArray(y),h=Array.isArray(s),C=L===h;return C?L?u.arrayMerge(s,y,u):b(s,y,u):i(y,u)}x.all=function(y,u){if(!Array.isArray(y))throw new Error("first argument should be an array");return y.reduce(function(L,h){return x(L,h,u)},{})};var S=x;return A=S,A}var te=ee();const N=Z(te),w={scale:1,canScale:!0,maxScale:10,minScale:.1,autoCenter:!0,autoScale:!0,containerAutoSize:!1,containerWidth:1e3,containerHeight:500,containerXPadding:800,containerYPadding:800,canvasWidth:1920,canvasHeight:1e3,proxyScaleKey:!0,useScrollBar:!0,useRuler:!0,usePositionLine:!0,adsorptionXList:[],adsorptionYList:[],positionLineConfig:{lineColor:"#6CC6A7",padding:3,adsorptionGap:4,zIndex:300},canvasStyle:{},scrollBarConfig:{bgColor:"#000000",opacity:.4,zIndex:500,barSize:8},rulerConfig:{yRulerWidth:20,xRulerHeight:20,bgColor:"#f5f5f5",fontColor:"#797B80",fontSize:10,fontFamily:"Arial",lineColor:"#797B80",zIndex:400}};(function(){const l={};for(const v in w){const n=w[v];typeof n=="object"&&n!==null?l[v]=()=>n:l[v]=n}return l})();const ne={scale:{type:Number,default:w.scale},minScale:{type:Number,default:w.minScale},maxScale:{type:Number,default:w.maxScale},canScale:{type:Boolean,default:w.canScale},autoCenter:{type:Boolean,default:w.autoCenter},autoScale:{type:Boolean,default:w.autoScale},containerAutoSize:{type:Boolean,default:w.containerAutoSize},containerWidth:{type:Number,default:w.containerWidth},containerHeight:{type:Number,default:w.containerHeight},containerXPadding:{type:Number,default:w.containerXPadding},containerYPadding:{type:Number,default:w.containerYPadding},canvasWidth:{type:Number,default:w.canvasWidth},canvasHeight:{type:Number,default:w.canvasHeight},proxyScaleKey:{type:Boolean,default:w.proxyScaleKey},useScrollBar:{type:Boolean,default:w.useScrollBar},useRuler:{type:Boolean,default:w.useRuler},usePositionLine:{type:Boolean,default:w.usePositionLine},positionLineConfig:{type:Object,default:w.positionLineConfig},canvasStyle:{type:Object,default:w.canvasStyle},scrollBarConfig:{type:Object,default:w.scrollBarConfig},rulerConfig:{type:Object,default:w.rulerConfig},adsorptionXList:{type:Object,default:w.adsorptionXList},adsorptionYList:{type:Object,default:w.adsorptionYList}},oe=(l,v)=>{const n=e.reactive({width:0,height:0,originWidth:0,originHeight:0});function a(i,r){new ResizeObserver(p=>{for(const m of p)if(m.target===r){const g=r.offsetWidth,o=r.offsetHeight;(g!==n.originWidth||o!==n.originHeight)&&t(i,r)}}).observe(r)}function t(i,r,d=!1){const p=i.value;p.containerAutoSize?(n.width=r.offsetWidth,n.height=r.offsetHeight,n.originWidth=n.width,n.originHeight=n.height,d&&a(i,r)):(n.width=p.containerWidth,n.height=p.containerHeight);const m=getComputedStyle(r);m.boxSizing==="border-box"&&(n.width-=parseFloat(m.borderLeftWidth)+parseFloat(m.borderRightWidth),n.height-=parseFloat(m.borderTopWidth)+parseFloat(m.borderBottomWidth)),m.position==="static"&&(n.position="relative")}e.onMounted(()=>{const i=v.value;i&&t(l,i,!0)});const f=e.computed(()=>({width:n.width,height:n.height})),c=e.computed(()=>{const i=l.value,r={overflow:"hidden"};return i.containerAutoSize||(r.width=n.width+"px",r.height=n.height+"px"),n.position&&(r.position=n.position),r});return{containerInfo:f,containerStyle:c}},re=(l,v,n,a)=>{const t=e.reactive({});return e.watch(()=>v.value,()=>{const f=l.value;let c=t.translateX||0,i=t.translateY||0,r=0,d=0,{scale:p}=f;const{autoCenter:m,autoScale:g}=f,{width:o,height:b}=v.value;if(g){const s=(o-160)/f.canvasWidth,y=(b-2*80)/f.canvasHeight;p=Math.min(s,y)}t.scale=p;let x=0,S=0;r=f.canvasWidth*p,d=f.canvasHeight*p,m&&(x=Math.floor((o-r)/2),S=Math.floor((b-d)/2),t.translateX=x,t.translateY=S),f.scale!==p&&n(p),(c!==x||i||S)&&a(x,S)},{deep:!0}),{transformInfo:t}},ae=(l,v,n)=>({scrollBarInfo:e.computed(()=>{const t=l.value,{width:f,height:c}=v.value,{translateX:i,translateY:r,scale:d}=n,p=t.canvasWidth*d+2*t.containerXPadding,m=t.canvasHeight*d+2*t.containerYPadding,g=f<p,o=c<m,b=g||o,x=f*((t.containerXPadding-i)/p),S=c*((t.containerYPadding-r)/m),s=f/p*f,y=c/m*c;return{totalHeight:m,totalWidth:p,left:x,top:S,width:s,height:y,isYLarge:o,isXLarge:g,isLarge:b}})});function D(l,v,n){const a=l.value,{containerXPadding:t,containerYPadding:f,canvasWidth:c,canvasHeight:i}=a,r=c*n,d=i*n,{width:p,height:m}=v.value,g=Math.max((p-r)/2,t),o=Math.max((m-d)/2,f),b=r+2*t>p?p-(r+t):g,x=d+2*f>m?m-(d+f):o;return{maxTranslateX:g,maxTranslateY:o,minTranslateX:b,minTranslateY:x}}const ie=(l,v,n)=>({boundaryInfo:e.computed(()=>D(l,v,n.scale))}),k=(l,v,n,a,t,f)=>{const c=l.value;if(!c.canScale)return;let{translateX:i,translateY:r,scale:d}=n,p=i,m=r;a=Math.min(Math.max(a,c.minScale),c.maxScale);const g=a-d,o=D(l,v,a);i-=g*c.canvasWidth/2,r-=g*c.canvasHeight/2,i=Math.max(Math.min(i,o.maxTranslateX),o.minTranslateX),r=Math.max(Math.min(r,o.maxTranslateY),o.minTranslateY),n.scale=a,n.translateX=i,n.translateY=r,t(a),(p!==i||m!==r)&&f(i,r)},le=(l,v,n,a,t)=>{l.value.proxyScaleKey&&document.addEventListener("keydown",f=>{if(l.value.canScale){const c=f.keyCode;if((f.metaKey||f.ctrlKey)&&(c===187||c===189)){f.preventDefault();const i=n.scale+(c===187?.05:-.05);k(l,v,n,i,a,t)}}})},se=(l,v,n,a,t,f,c,i,r)=>{let d=null;Object.assign(c,{xOpacity:0,yOpacity:0,scrollBarMouseDown:!1,scrollBarEnter:!1}),e.onMounted(()=>{t.value&&t.value.addEventListener("wheel",p=>{if(l.value.canScale)if(p.metaKey||p.ctrlKey){p.preventDefault();const m=-1*p.deltaY/100,g=n.scale+m;k(l,v,n,g,i,r)}else{if(!f.value.isLarge||c.scrollBarMouseDown)return;p.preventDefault();let{translateX:m,translateY:g}=n;d&&clearTimeout(d);const o=-p.deltaX,b=-p.deltaY;let x="";const{opacity:S=.4}=l.value.scrollBarConfig,{isXLarge:s,isYLarge:y}=f.value,{maxTranslateX:u,minTranslateX:L,maxTranslateY:h,minTranslateY:C}=a.value;s&&Math.abs(o)>Math.abs(b)&&(m+=o,m=Math.max(Math.min(m,u),L),c.xOpacity=S,c.yOpacity=0,n.translateX=m,x="x"),y&&Math.abs(b)>Math.abs(o)&&(x="y",g+=b,g=Math.max(Math.min(g,h),C),c.yOpacity=S,c.xOpacity=0,n.translateY=g),x&&(r(n.translateX,n.translateY),d=setTimeout(()=>{c.scrollBarEnter||(c[x==="y"?"yOpacity":"xOpacity"]=0)},1e3))}})})};return e.defineComponent({__name:"index",props:ne,emits:["update:scale","onScale","onMove","update:adsorptionXList","update:adsorptionYList"],setup(l,{expose:v,emit:n}){const a=l,t=e.ref(N(w,a,{arrayMerge:W})),f=n,c=e.ref(null),{containerInfo:i,containerStyle:r}=oe(t,c),{transformInfo:d}=re(t,i,o,b),{boundaryInfo:p}=ie(t,i,d),{scrollBarInfo:m}=ae(t,i,d),g=e.reactive({});e.watch(()=>d.scale,O=>{if(O){if(!g.scale){const B={scale:O,translateX:d.translateX,translateY:d.translateY};Object.assign(g,B)}f("update:scale",O)}}),e.watch(()=>a,()=>{t.value=N(t.value,a,{arrayMerge:W})},{deep:!0});function o(O){f("onScale",O)}function b(O,B){f("onMove",O,B)}function x(O){k(t,i,d,O,o,b)}e.watch(()=>t.value.scale,O=>{O!==d.scale&&x(O)}),le(t,i,d,o,b);const S=e.reactive({});se(t,i,d,p,c,m,S,o,b);function s(O,B){f(`update:adsorption${B?"Y":"X"}List`,O)}function y(){Object.assign(d,g)}const u=e.ref(null),L=e.ref(null);function h(){t.value.useRuler&&(u.value&&u.value.removeAllPositionLine(),L.value&&L.value.removeAllPositionLine())}function C(O=!0){t.value.useRuler&&(u.value&&u.value.toggleRuler(O),L.value&&L.value.toggleRuler(O))}function R(O=!0){t.value.useRuler&&(u.value&&u.value.togglePositionLine(O),L.value&&L.value.togglePositionLine(O))}function j(O,B=!0,q=!1){t.value.useRuler&&(q&&u.value&&u.value.modifyAdsorptionList(O,B),!q&&L.value&&L.value.modifyAdsorptionList(O,B))}function M(O){let B=[];return t.value.useRuler&&(O?u.value&&(B=u.value.getPositionLineList()):L.value&&(B=L.value.getPositionLineList())),B}return v({reset:y,changeScale:x,removeAllPositionLine:h,showRuler(){C()},hideRuler(){C(!1)},showAllPositionLine(){R()},hideAllPositionLine(){R(!1)},addAdsorptionLine(O,B=!1){j(O,!0,B)},removeAdsorptionLine(O,B=!1){j(O,!1,B)},getPositionLineList:M}),(O,B)=>(e.openBlock(),e.createElementBlock("div",{class:"scale-ruler",ref_key:"container",ref:c,style:e.normalizeStyle(e.unref(r))},[t.value.useRuler?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(H,{ref_key:"xRuler",ref:u,opt:t.value,"container-info":e.unref(i),"transform-info":e.unref(d),onUpdateAdsorptionList:s},null,8,["opt","container-info","transform-info"]),e.createVNode(H,{ref_key:"yRuler",ref:L,"is-y":"",opt:t.value,"container-info":e.unref(i),"transform-info":e.unref(d),onUpdateAdsorptionList:s},null,8,["opt","container-info","transform-info"])],64)):e.createCommentVNode("",!0),e.createVNode(F,{"container-info":e.unref(i),opt:t.value,"transform-info":e.unref(d)},{default:e.withCtx(()=>[e.renderSlot(O.$slots,"default")]),_:3},8,["container-info","opt","transform-info"]),e.unref(m).isXLarge?(e.openBlock(),e.createBlock(z,{key:1,opt:t.value,"container-info":e.unref(i),"scroll-bar-info":e.unref(m),"global-info":S,"transform-info":e.unref(d),onOnMove:b},null,8,["opt","container-info","scroll-bar-info","global-info","transform-info"])):e.createCommentVNode("",!0),e.unref(m).isYLarge?(e.openBlock(),e.createBlock(z,{key:2,opt:t.value,"container-info":e.unref(i),"scroll-bar-info":e.unref(m),"global-info":S,"transform-info":e.unref(d),onOnMove:b,"is-y":""},null,8,["opt","container-info","scroll-bar-info","global-info","transform-info"])):e.createCommentVNode("",!0)],4))}})});
