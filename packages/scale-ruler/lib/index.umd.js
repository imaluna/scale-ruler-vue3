(function(e,E){typeof exports=="object"&&typeof module<"u"?module.exports=E(require("vue")):typeof define=="function"&&define.amd?define(["vue"],E):(e=typeof globalThis<"u"?globalThis:e||self,e.ScaleRuler=E(e.Vue))})(this,function(e){"use strict";const E=e.defineComponent({__name:"CanvasPanel",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},setup(l){const d=l,t=e.computed(()=>{var c,o;return{position:"absolute",left:0,top:0,width:((c=d.opt)==null?void 0:c.canvasWidth)+"px",height:((o=d.opt)==null?void 0:o.canvasHeight)+"px",transition:"transform 300ms",transformOrigin:"0 0",transform:`translate(${d.transformInfo.translateX}px, ${d.transformInfo.translateY}px) scale(${d.transformInfo.scale})`,...d.opt.canvasStyle}});return(c,o)=>(e.openBlock(),e.createElementBlock("div",{ref:"canvasPanel",style:e.normalizeStyle(t.value)},null,4))}}),X=e.defineComponent({__name:"ScrollBar",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},scrollBarInfo:{type:Object,required:!0},globalInfo:{type:Object,required:!0},transformInfo:{type:Object,required:!0}},setup(l){const d=l,{globalInfo:t,transformInfo:c}=e.toRefs(d),o=e.computed(()=>{const{opt:r,scrollBarInfo:n,isY:p}=d,{scrollBarConfig:s}=r,y={position:"absolute",borderRadius:"4px",backgroundColor:s.bgColor,opacity:d.globalInfo[p?"yOpacity":"xOpacity"]||0,transition:"opacity 300ms",cursor:"pointer",zIndex:s.zIndex,width:(p?s.barSize:n.width)+"px",height:(p?n.height:s.barSize)+"px"};return p?(y.top=n.top+"px",y.right=0):(y.left=n.left+"px",y.bottom=0),y}),g=e.ref(null),a={};function u(r){if(r.preventDefault(),!t.value.scrollBarMouseDown)return;let{translateX:n,translateY:p}=c.value;const s=d.scrollBarInfo,{width:y,height:f}=d.containerInfo;if(d.isY){const v=r.pageY-a.startY;let x=a.top+v;x=Math.min(Math.max(0,x),f-s.height);const S=x*s.totalHeight/f;p=d.opt.containerYPadding-S,c.value.translateY=p}else{const v=r.pageX-a.startX;let x=a.left+v;x=Math.min(Math.max(0,x),y-s.width);const S=x*s.totalWidth/y;n=d.opt.containerXPadding-S,c.value.translateX=n}}return e.onMounted(()=>{if(g.value){const r=g.value,n=d.isY?"yOpacity":"xOpacity";r.addEventListener("mouseenter",()=>{t.value[n]=d.opt.scrollBarConfig.opacity,t.value[d.isY?"xOpacity":"yOpacity"]=0,t.value.scrollBarEnter=!0}),r.addEventListener("mouseleave",()=>{t.value.scrollBarMouseDown||(t.value.scrollBarEnter=!1,t.value[n]=0)}),r.addEventListener("mousedown",p=>{p.preventDefault(),t.value.scrollBarMouseDown=!0,a.startX=p.pageX,a.startY=p.pageY,a.left=d.scrollBarInfo.left,a.top=d.scrollBarInfo.top,document.addEventListener("mousemove",u)}),document.addEventListener("mouseup",()=>{t.value.scrollBarMouseDown&&(t.value.scrollBarMouseDown=!1,document.removeEventListener("mousemove",u))})}}),(r,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"scrollBarRef",ref:g,style:e.normalizeStyle(o.value)},null,4))}}),H=l=>l<=.25?40:l<=.5?20:l<=1?10:l<=2?5:l<=4?2:1,D=l=>{const d=l.getBoundingClientRect(),t=d.top+(document.body.scrollTop||document.documentElement.scrollTop),c=d.left+(document.body.scrollLeft||document.documentElement.scrollLeft);return{top:t,left:c}},_=(l,d,t)=>{const{scale:c,translateX:o,translateY:g}=l;return(d-(t?g:o))/c},j=(l,d,t)=>{const{scale:c,translateX:o,translateY:g}=l,a=d*c;return(t?g:o)+a};function A(l,d,t,c,o,g){const a={coordinate:o,translate:c},u=l.length;if(u>0){let r=0;for(;r<u;){const n=l[r];if(Math.abs(o-n)<=t){a.coordinate=n,a.translate=j(d,n,g);break}else if(n>o)break;r++}}return a}const q=(l,d,t,c)=>{e.nextTick(()=>{const o=c.value;if(o){const g=o.offsetWidth,a=o.offsetHeight,{rulerConfig:u}=l,{bgColor:r,fontFamily:n,fontSize:p,lineColor:s,fontColor:y}=u;if(g>0&&a>0){const f=o.getContext("2d");f.clearRect(0,0,g,a),r&&(f.save(),f.fillStyle=r,f.fillRect(0,0,g,a),f.restore());const v=t?u.yRulerWidth:u.xRulerHeight,{translateX:x,translateY:S,scale:i}=d,m=t?S:x,h=H(i),L=h*i,b=window.devicePixelRatio,w=-m,B=Math.floor(w/L),M=Math.floor(((t?a:g)-m)/L);f.save(),f.fillStyle=s,f.font=`${p*b}px ${n}`,f.translate(.5,.5),f.scale(1/b,1/b),t?f.fillRect((v-1)*b,0,1,a*b):f.fillRect(0,(v-1)*b,g*b,1);for(let O=B;O<=M;O++){f.fillStyle=s;const C=(m+O*L)*b;let R=v/4;O%10===0?R=v*4/5:O%5===0&&(R=v/3),t?f.fillRect((v-R)*b,C,R*b,1):(f.fillRect(C,(v-R)*b,1,R*b),O%10===0&&(f.fillStyle=y,f.fillText(String(O*h),C+2*b,(v+8-R)*b)))}if(f.restore(),t){f.font=`${p}px ${n}`;let O=B;for(;O<=M;)if(O%10)O++;else{f.save();const C=m+O*L+v/2;f.translate(C+v/5,C-v*6/5),f.rotate(Math.PI/2),f.fillText(String(O*h),v*4/5,C),O+=10,f.restore()}}}}})},$=(l,d)=>{const t=e.reactive([0]);function c(n,p=!0){const s=t.indexOf(n);p&&s===-1&&t.push(n),!p&&s>-1&&t.splice(s,1),p&&t.sort((y,f)=>y-f)}function o(n,p=!0){Array.isArray(n)?n.forEach(s=>c(s,p)):c(n,p)}function g(n){o(n)}function a(n){o(n,!1)}const u=e.computed(()=>l.positionLineConfig[d?"adsorptionYList":"adsorptionXList"]);e.watch(()=>u.value,n=>{g(n)},{deep:!0});const r=e.computed(()=>d?l.canvasWidth:l.canvasHeight);return e.watch(()=>r.value,(n,p)=>{p!==void 0&&a(p),g(n)},{immediate:!0}),{adsorptionList:t,modifyAdsorptionList:o}},F=(l,d,t,c,o,g)=>{let a=1;const u=e.reactive([]);let r=-1,n=!1;function p(s){if(n&&r>-1){s.preventDefault();const{xRulerHeight:y,yRulerWidth:f}=l.value.rulerConfig,v=u[r],x=(o?s.pageY:s.pageX)-v.start,S=v.startTranslate+x,i=S>(o?y:f),m=_(c.value,S,o),h=A(t,c.value,l.value.positionLineConfig.adsorptionGap,S,m,o);u[r].showTip=i,u[r].coordinate=h.coordinate}}return e.onMounted(()=>{if(g.value){const s=g.value;s.addEventListener("mousedown",y=>{const f=D(s),v=o?y.pageY:y.pageX,x=v-(o?f.top:f.left),S={startTranslate:x,start:v,id:a,coordinate:_(c.value,x,o),showTip:!1,show:!0,needAnimate:!1};r=a,u[a++]=S,n=!0,document.addEventListener("mousemove",p)}),document.addEventListener("mouseup",()=>{if(document.removeEventListener("mousemove",p),!n||r<0)return;n=!1;const y=u[r],{width:f,height:v}=d.value,{xRulerHeight:x,yRulerWidth:S}=l.value.rulerConfig;y.translate<=(o?x:S)||y.translate>=(o?v:f)?delete u[r]:(u[r].showTip=!1,u[r].needAnimate=!0),r=-1})}}),{positionLineMap:u}},N=(l,d,t,c,o,g,a,u)=>{let r=!1;function n(s){a.value.showTip=s}function p(s){if(!r)return;const y=(o?s.pageY:s.pageX)-a.value.start,f=a.value.startTranslate+y,v=_(c.value,f,o),x=A(t.value,c.value,l.value.positionLineConfig.adsorptionGap,f,v,o);a.value.coordinate=x.coordinate}e.onMounted(()=>{if(g.value){const s=g.value;s.addEventListener("mouseenter",()=>{n(!0)}),s.addEventListener("mouseleave",()=>{console.log({isMouseDown:r}),r||n(!1)}),s.addEventListener("mousedown",y=>{y.preventDefault(),r=!0,a.value.showTip=!0;const f=o?y.pageY:y.pageX;a.value.start=f,a.value.startTranslate=j(c.value,a.value.coordinate,o),a.value.needAnimate=!1,document.addEventListener("mousemove",p)}),document.addEventListener("mouseup",()=>{if(!r)return;r=!1;const{translate:y,id:f}=a.value,{width:v,height:x}=d.value,{xRulerHeight:S,yRulerWidth:i}=l.value.rulerConfig;y<=(o?S:i)||y>=(o?x:v)?u(f):(n(!1),a.value.needAnimate=!0),document.removeEventListener("mousemove",p)})}})},V=e.defineComponent({__name:"PositionLine",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},transformInfo:{type:Object,required:!0},lineInfo:{type:Object,required:!0},adsorptionList:{type:Array,required:!0}},emits:["remove-position-line"],setup(l,{emit:d}){const t=l,{lineInfo:c,adsorptionList:o,transformInfo:g,opt:a,containerInfo:u}=e.toRefs(t),r=e.computed(()=>a.value.positionLineConfig.padding),n=e.computed(()=>2*r.value+1),p=e.computed(()=>j(g.value,c.value.coordinate,t.isY)),s=e.computed(()=>{const{width:h,height:L}=u.value,{isY:b}=t,w=b?`translate(0, ${p.value}px)`:`translate(${p.value}px, 0)`;return{display:c.value.show?"block":"none",position:"absolute",width:(b?h:n.value)+"px",height:(b?n.value:L)+"px",cursor:b?"row-resize":"col-resize",top:(b?-r.value:0)+"px",left:(b?0:-r.value)+"px",transform:w,zIndex:t.opt.positionLineConfig.zIndex,transition:c.value.needAnimate?"transform 300ms":""}}),y=e.computed(()=>{const{isY:h}=t;return{position:"absolute",width:h?"100%":"1px",height:h?"1px":"100%",backgroundColor:a.value.positionLineConfig.lineColor,top:(h?r.value:0)+"px",left:(h?0:r.value)+"px"}}),f=e.ref({}),v=e.computed(()=>{const{isY:h}=t,{width:L,height:b}=u.value,{tipWidth:w,tipHeight:B}=f.value;let M,O;return w&&B?(O=h?"50%":(p.value+n.value+w>=L?-w:n.value)+"px",M=h?(p.value+n.value+B>=b?-B:n.value)+"px":"50%"):(O=h?"50%":n.value+"px",M=h?n.value+"px":"50%"),{position:"absolute",padding:"5px",lineHeight:"18px",minWidth:"80px",backgroundColor:"rgba(0,0,0,.8)",color:"#fff",fontSize:"12px",borderRadius:"4px",userSelect:"none",textAlign:"center",left:O,top:M,transform:h?"translate(-50%, 0)":"translate(0, -50%)",visibility:c.value.showTip?"visible":"hidden"}}),x=e.ref(null),S=d;function i(h){S("remove-position-line",h)}N(a,u,o,g,t.isY,x,c,i);const m=e.ref(null);return e.onMounted(()=>{if(m.value){const h=m.value,L=h.offsetWidth,b=h.offsetHeight;f.value.tipWidth=L,f.value.tipHeight=b}}),(h,L)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"positionLineRef",ref:x,class:"scale-ruler_position-line",style:e.normalizeStyle(s.value)},[e.createElementVNode("div",{class:"scale-ruler_position-line_inner",style:e.normalizeStyle(y.value)},null,4),e.createElementVNode("div",{class:"scale-ruler_position-line_tip",style:e.normalizeStyle(v.value),ref_key:"tipRef",ref:m},e.toDisplayString((l.isY?"Y":"X")+": "+ +e.unref(c).coordinate.toFixed(2)+" px"),5)],4))}}),K=["width","height"],k=e.defineComponent({__name:"Ruler",props:{containerInfo:{type:Object,required:!0},opt:{type:Object,required:!0},isY:{type:Boolean,default:!1},transformInfo:{type:Object,required:!0}},setup(l,{expose:d}){const t=l,{opt:c,transformInfo:o,containerInfo:g}=e.toRefs(t),a=e.computed(()=>{const{isY:i,containerInfo:m,opt:h}=t;return{width:i?h.rulerConfig.yRulerWidth:m.width,height:i?m.height:h.rulerConfig.xRulerHeight}}),u=e.computed(()=>({position:"absolute",left:0,top:0,zIndex:t.opt.rulerConfig.zIndex+(t.isY?0:1)})),r=e.ref();e.watch([()=>t.containerInfo,()=>t.transformInfo],()=>{q(t.opt,t.transformInfo,t.isY,r)},{deep:!0});const{adsorptionList:n,modifyAdsorptionList:p}=$(t.opt,t.isY),{positionLineMap:s}=F(c,g,n,o,!t.isY,r);function y(i){delete s[i]}function f(){Object.keys(s).forEach(i=>{y(i)})}function v(i=!0){Object.keys(s).forEach(m=>{s[m].show=i})}const x=e.ref(!0);function S(i=!0){x.value=i,v(i)}return d({modifyAdsorptionList:p,removeAllPositionLine:f,togglePositionLine:v,toggleRuler:S}),(i,m)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("canvas",{ref_key:"rulerRef",ref:r,style:e.normalizeStyle(u.value),width:a.value.width,height:a.value.height},null,12,K),[[e.vShow,x.value]]),t.opt.usePositionLine?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass("position-line-"+(t.isY?"x":"y"))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.keys(e.unref(s)),h=>(e.openBlock(),e.createBlock(V,{key:h,opt:t.opt,"is-y":!t.isY,"transform-info":t.transformInfo,"container-info":t.containerInfo,"line-info":e.unref(s)[h],"adsorption-list":e.unref(n),onRemovePositionLine:y},null,8,["opt","is-y","transform-info","container-info","line-info","adsorption-list"]))),128))],2)):e.createCommentVNode("",!0)],64))}});function G(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var T,W;function U(){if(W)return T;W=1;var l=function(m){return d(m)&&!t(m)};function d(i){return!!i&&typeof i=="object"}function t(i){var m=Object.prototype.toString.call(i);return m==="[object RegExp]"||m==="[object Date]"||g(i)}var c=typeof Symbol=="function"&&Symbol.for,o=c?Symbol.for("react.element"):60103;function g(i){return i.$$typeof===o}function a(i){return Array.isArray(i)?[]:{}}function u(i,m){return m.clone!==!1&&m.isMergeableObject(i)?x(a(i),i,m):i}function r(i,m,h){return i.concat(m).map(function(L){return u(L,h)})}function n(i,m){if(!m.customMerge)return x;var h=m.customMerge(i);return typeof h=="function"?h:x}function p(i){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(i).filter(function(m){return Object.propertyIsEnumerable.call(i,m)}):[]}function s(i){return Object.keys(i).concat(p(i))}function y(i,m){try{return m in i}catch{return!1}}function f(i,m){return y(i,m)&&!(Object.hasOwnProperty.call(i,m)&&Object.propertyIsEnumerable.call(i,m))}function v(i,m,h){var L={};return h.isMergeableObject(i)&&s(i).forEach(function(b){L[b]=u(i[b],h)}),s(m).forEach(function(b){f(i,b)||(y(i,b)&&h.isMergeableObject(m[b])?L[b]=n(b,h)(i[b],m[b],h):L[b]=u(m[b],h))}),L}function x(i,m,h){h=h||{},h.arrayMerge=h.arrayMerge||r,h.isMergeableObject=h.isMergeableObject||l,h.cloneUnlessOtherwiseSpecified=u;var L=Array.isArray(m),b=Array.isArray(i),w=L===b;return w?L?h.arrayMerge(i,m,h):v(i,m,h):u(m,h)}x.all=function(m,h){if(!Array.isArray(m))throw new Error("first argument should be an array");return m.reduce(function(L,b){return x(L,b,h)},{})};var S=x;return T=S,T}var J=U();const z=G(J),P={scale:1,canScale:!0,maxScale:10,minScale:.1,autoCenter:!0,autoScale:!0,containerAutoSize:!1,containerWidth:1e3,containerHeight:500,containerXPadding:80,containerYPadding:80,canvasWidth:1920,canvasHeight:1e3,proxyScaleKey:!0,useScrollBar:!0,useRuler:!0,usePositionLine:!0,positionLineConfig:{lineColor:"#24aa61",padding:3,adsorptionXList:[],adsorptionYList:[],adsorptionGap:4,zIndex:300},canvasStyle:{},scrollBarConfig:{bgColor:"#000000",opacity:.4,zIndex:500,barSize:8},rulerConfig:{yRulerWidth:30,xRulerHeight:30,bgColor:"#efefef",fontColor:"#000000",fontSize:12,fontFamily:"Arial",lineColor:"#000000",zIndex:400},onScale:()=>{},onMove:()=>{}},Q=function(){const l={};for(const d in P){const t=P[d];typeof t=="object"&&t!==null?l[d]=()=>t:l[d]=t}return l}(),Z=(l,d)=>{const t=e.reactive({width:0,height:0,originWidth:0,originHeight:0});function c(u,r){new ResizeObserver(p=>{for(const s of p)if(s.target===r){const y=r.offsetWidth,f=r.offsetHeight;(y!==t.originWidth||f!==t.originHeight)&&o(u,r)}}).observe(r)}function o(u,r,n=!1){const p=u.value;p.containerAutoSize?(t.width=r.offsetWidth,t.height=r.offsetHeight,t.originWidth=t.width,t.originHeight=t.height,n&&c(u,r)):(t.width=p.containerWidth,t.height=p.containerHeight);const s=getComputedStyle(r);s.boxSizing==="border-box"&&(t.width-=parseFloat(s.borderLeftWidth)+parseFloat(s.borderRightWidth),t.height-=parseFloat(s.borderTopWidth)+parseFloat(s.borderBottomWidth)),s.position==="static"&&(t.position="relative")}e.onMounted(()=>{const u=d.value;u&&o(l,u,!0)});const g=e.computed(()=>({width:t.width,height:t.height})),a=e.computed(()=>{const u=l.value,r={overflow:"hidden"};return u.containerAutoSize||(r.width=t.width+"px",r.height=t.height+"px"),t.position&&(r.position=t.position),r});return{containerInfo:g,containerStyle:a}},ee=(l,d)=>{const t=e.reactive({});return e.watch(()=>d.value,()=>{const c=l.value;let o=0,g=0,{scale:a}=c;const{autoCenter:u,autoScale:r}=c,{width:n,height:p}=d.value;if(r){const f=(n-2*c.containerXPadding)/c.canvasWidth,v=(p-2*c.containerYPadding)/c.canvasHeight;a=Math.min(f,v)}t.scale=a;let s=0,y=0;o=c.canvasWidth*a,g=c.canvasHeight*a,u&&(s=Math.floor((n-o)/2),y=Math.floor((p-g)/2),t.translateX=s,t.translateY=y)},{deep:!0}),{transformInfo:t}},te=(l,d,t)=>({scrollBarInfo:e.computed(()=>{const o=l.value,{width:g,height:a}=d.value,{translateX:u,translateY:r,scale:n}=t,p=o.canvasWidth*n+2*o.containerXPadding,s=o.canvasHeight*n+2*o.containerYPadding,y=g<p,f=a<s,v=y||f,x=g*((o.containerXPadding-u)/p),S=a*((o.containerYPadding-r)/s),i=g/p*g,m=a/s*a;return{totalHeight:s,totalWidth:p,left:x,top:S,width:i,height:m,isYLarge:f,isXLarge:y,isLarge:v}})});function I(l,d,t){const c=l.value,{containerXPadding:o,containerYPadding:g,canvasWidth:a,canvasHeight:u}=c,r=a*t,n=u*t,{width:p,height:s}=d.value,y=Math.max((p-r)/2,o),f=Math.max((s-n)/2,g),v=r+2*o>p?p-(r+o):y,x=n+2*g>s?s-(n+g):f;return{maxTranslateX:y,maxTranslateY:f,minTranslateX:v,minTranslateY:x}}const ne=(l,d,t)=>({boundaryInfo:e.computed(()=>I(l,d,t.scale))}),Y=(l,d,t,c)=>{const o=l.value;let{translateX:g,translateY:a,scale:u}=t;c=Math.min(Math.max(c,o.minScale),o.maxScale);const r=c-u,n=I(l,d,c);g-=r*o.canvasWidth/2,a-=r*o.canvasHeight/2,g=Math.max(Math.min(g,n.maxTranslateX),n.minTranslateX),a=Math.max(Math.min(a,n.maxTranslateY),n.minTranslateY),t.scale=c,t.translateX=g,t.translateY=a},oe=(l,d,t)=>{l.value.proxyScaleKey&&document.addEventListener("keydown",c=>{if(l.value.canScale){const o=c.keyCode;if((c.metaKey||c.ctrlKey)&&(o===187||o===189)){c.preventDefault();const g=t.scale+(o===187?.05:-.05);Y(l,d,t,g)}}})},re=(l,d,t,c,o,g,a)=>{let u=null;Object.assign(a,{xOpacity:0,yOpacity:0,scrollBarMouseDown:!1,scrollBarEnter:!1}),e.onMounted(()=>{o.value&&o.value.addEventListener("wheel",r=>{if(l.value.canScale)if(r.metaKey||r.ctrlKey){r.preventDefault();const n=-1*r.deltaY/100,p=t.scale+n;Y(l,d,t,p)}else{if(!g.value.isLarge||a.scrollBarMouseDown)return;r.preventDefault();let{translateX:n,translateY:p}=t;u&&clearTimeout(u);const s=-r.deltaX,y=-r.deltaY;let f="";const{opacity:v=.4}=l.value.scrollBarConfig,{isXLarge:x,isYLarge:S}=g.value,{maxTranslateX:i,minTranslateX:m,maxTranslateY:h,minTranslateY:L}=c.value;x&&Math.abs(s)>Math.abs(y)&&(n+=s,n=Math.max(Math.min(n,i),m),a.xOpacity=v,a.yOpacity=0,t.translateX=n,f="x"),S&&Math.abs(y)>Math.abs(s)&&(f="y",p+=y,p=Math.max(Math.min(p,h),L),a.yOpacity=v,a.xOpacity=0,t.translateY=p),f&&(u=setTimeout(()=>{a.scrollBarEnter||(a[f==="y"?"yOpacity":"xOpacity"]=0)},1e3))}})})};return e.defineComponent({__name:"index",props:e.mergeDefaults({scale:{},minScale:{},maxScale:{},canScale:{type:Boolean},autoCenter:{type:Boolean},autoScale:{type:Boolean},containerAutoSize:{type:Boolean},containerWidth:{},containerHeight:{},containerXPadding:{},containerYPadding:{},canvasWidth:{},canvasHeight:{},proxyScaleKey:{type:Boolean},useScrollBar:{type:Boolean},useRuler:{type:Boolean},usePositionLine:{type:Boolean},positionLineConfig:{},canvasStyle:{},scrollBarConfig:{},rulerConfig:{},onScale:{type:Function},onMove:{type:Function}},Q),emits:["update:scale"],setup(l,{expose:d,emit:t}){const c=l,o=e.ref(z(P,c)),g=t,a=e.ref(null),{containerInfo:u,containerStyle:r}=Z(o,a),{transformInfo:n}=ee(o,u),{boundaryInfo:p}=ne(o,u,n),{scrollBarInfo:s}=te(o,u,n),y=e.reactive({});e.watch(()=>n.scale,w=>{if(w){if(!y.scale){const B={scale:w,translateX:n.translateX,translateY:n.translateY};Object.assign(y,B)}g("update:scale",w)}}),e.watch(()=>c,()=>{o.value=z(o.value,c)},{deep:!0});function f(w){Y(o,u,n,w)}e.watch(()=>o.value.scale,w=>{w!==n.scale&&f(w)}),oe(o,u,n);const v=e.reactive({});re(o,u,n,p,a,s,v);function x(){Object.assign(n,y)}const S=e.ref(null),i=e.ref(null);function m(){o.value.useRuler&&(S.value&&S.value.removeAllPositionLine(),i.value&&i.value.removeAllPositionLine())}function h(w=!0){o.value.useRuler&&(S.value&&S.value.toggleRuler(w),i.value&&i.value.toggleRuler(w))}function L(w=!0){o.value.useRuler&&(S.value&&S.value.togglePositionLine(w),i.value&&i.value.togglePositionLine(w))}function b(w,B=!0,M=!1){o.value.useRuler&&(M&&S.value&&S.value.modifyAdsorptionList(w,B),!M&&i.value&&i.value.modifyAdsorptionList(w,B))}return d({reset:x,changeScale:f,removeAllPositionLine:m,showRuler(){h()},hideRuler(){h(!1)},showAllPositionLine(){L()},hideAllPositionLine(){L(!1)},addAdsorptionLine(w,B=!1){b(w,!0,B)},removeAdsorptionLine(w,B=!1){b(w,!1,B)}}),(w,B)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:a,style:e.normalizeStyle(e.unref(r))},[o.value.useRuler?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(k,{ref_key:"xRuler",ref:S,opt:o.value,"container-info":e.unref(u),"transform-info":e.unref(n)},null,8,["opt","container-info","transform-info"]),e.createVNode(k,{ref_key:"yRuler",ref:i,"is-y":"",opt:o.value,"container-info":e.unref(u),"transform-info":e.unref(n)},null,8,["opt","container-info","transform-info"])],64)):e.createCommentVNode("",!0),e.createVNode(E,{"container-info":e.unref(u),opt:o.value,"transform-info":e.unref(n)},{default:e.withCtx(()=>[e.renderSlot(w.$slots,"default")]),_:3},8,["container-info","opt","transform-info"]),e.unref(s).isXLarge?(e.openBlock(),e.createBlock(X,{key:1,opt:o.value,"container-info":e.unref(u),"scroll-bar-info":e.unref(s),"global-info":v,"transform-info":e.unref(n)},null,8,["opt","container-info","scroll-bar-info","global-info","transform-info"])):e.createCommentVNode("",!0),e.unref(s).isYLarge?(e.openBlock(),e.createBlock(X,{key:2,opt:o.value,"container-info":e.unref(u),"scroll-bar-info":e.unref(s),"global-info":v,"transform-info":e.unref(n),"is-y":""},null,8,["opt","container-info","scroll-bar-info","global-info","transform-info"])):e.createCommentVNode("",!0)],4))}})});
